<!DOCTYPE html>
<html lang="zh-CN">
<head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>AI创业模拟 - CEO决策挑战</title>
        <script src="https://cdn.tailwindcss.com"></script>
        <link href="https://cdn.jsdelivr.net/npm/font-awesome@4.7.0/css/font-awesome.min.css" rel="stylesheet">
        <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        // 统一协调的霓虹配色方案
                        primary: '#00f0ff', // 电光蓝
                        secondary: '#ff2a6d', // 荧光粉
                        success: '#05ffa1', // 酸橙绿
                        warning: '#FFCC00', // 霓虹黄
                        danger: '#ff6b6b', // 霓虹红
                        neutral: '#0a0a0a', // 深黑色背景
                        'neutral-light': '#1a1a1a', // 卡片背景
                        'neon-purple': '#d300c5', // 霓虹紫
                        'neon-blue': '#00f0ff', // 电光蓝
                        'neon-pink': '#ff2a6d', // 荧光粉
                        'neon-green': '#05ffa1', // 酸橙绿
                        'neon-yellow': '#FFCC00', // 霓虹黄
                    },
                    fontFamily: {
                        sans: ['Inter', 'system-ui', 'sans-serif'],
                        bold: ['"Microsoft YaHei"', 'sans-serif'],
                        dingtalk: ['"Microsoft YaHei"', 'sans-serif'],
                    },
                    backgroundImage: {
                        'business-pattern': "url('data:image/svg+xml,%3Csvg width='100' height='100' viewBox='0 0 100 100' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M11 18c3.866 0 7-3.134 7-7s-3.134-7-7-7-7 3.134-7 7 3.134 7 7 7zm48 25c3.866 0 7-3.134 7-7s-3.134-7-7-7-7 3.134-7 7 3.134 7 7 7zm-43-7c1.657 0 3-1.343 3-3s-1.343-3-3-3-3 1.343-3 3 1.343 3 3 3zm63 31c1.657 0 3-1.343 3-3s-1.343-3-3-3-3 1.343-3 3 1.343 3 3 3zM34 90c1.657 0 3-1.343 3-3s-1.343-3-3-3-3 1.343-3 3 1.343 3 3 3zm56-76c1.657 0 3-1.343 3-3s-1.343-3-3-3-3 1.343-3 3 1.343 3 3 3zM12 86c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm28-65c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm23-11c2.76 0 5-2.24 5-5s-2.24-5-5-5-5 2.24-5 5 2.24 5 5 5zm-6 60c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm29 22c2.76 0 5-2.24 5-5s-2.24-5-5-5-5 2.24-5 5 2.24 5 5 5zM32 63c2.76 0 5-2.24 5-5s-2.24-5-5-5-5 2.24-5 5 2.24 5 5 5zm57-13c2.76 0 5-2.24 5-5s-2.24-5-5-5-5 2.24-5 5 2.24 5 5 5zm-9-21c1.105 0 2-.895 2-2s-.895-2-2-2-2 .895-2 2 .895 2 2 2zM60 91c1.105 0 2-.895 2-2s-.895-2-2-2-2 .895-2 2 .895 2 2 2zM35 41c1.105 0 2-.895 2-2s-.895-2-2-2-2 .895-2 2 .895 2 2 2zM12 60c1.105 0 2-.895 2-2s-.895-2-2-2-2 .895-2 2 .895 2 2 2z' fill='%23ffffff' fill-opacity='0.05' fill-rule='evenodd'/%3E%3C/svg%3E')",
                        'neon-gradient': 'linear-gradient(135deg, #00f0ff, #ff2a6d, #05ffa1, #FFCC00)',
                        'card-gradient': 'linear-gradient(135deg, rgba(10,10,10,0.8), rgba(26,26,26,0.9))',
                    },
                }
            }
        }
        
    </script>
    <style type="text/tailwindcss">
        @layer utilities {
            .content-auto {
                content-visibility: auto;
            }
            .glass-effect {
                backdrop-filter: blur(12px);
                background-color: rgba(26, 26, 26, 0.8);
            }
            .card-shadow {
                box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.3), 0 4px 6px -2px rgba(0, 0, 0, 0.2);
            }
            .card-hover {
                transition: all 0.3s ease;
            }
            .card-hover:hover {
                transform: translateY(-5px);
                box-shadow: 0 0 20px rgba(0, 240, 255, 0.3), 0 10px 10px -5px rgba(0, 0, 0, 0.1);
            }
            /* 霓虹发光效果 */
            .neon-glow {
                text-shadow: 0 0 5px currentColor, 0 0 10px currentColor, 0 0 20px currentColor;
            }
            .neon-glow-blue {
                text-shadow: 0 0 5px #00f0ff, 0 0 10px #00f0ff, 0 0 20px #00f0ff, 0 0 40px #00f0ff;
            }
            .neon-glow-pink {
                text-shadow: 0 0 5px #ff2a6d, 0 0 10px #ff2a6d, 0 0 20px #ff2a6d, 0 0 40px #ff2a6d;
            }
            .neon-glow-green {
                text-shadow: 0 0 5px #05ffa1, 0 0 10px #05ffa1, 0 0 20px #05ffa1, 0 0 40px #05ffa1;
            }
            .neon-glow-yellow {
                text-shadow: 0 0 5px #FFCC00, 0 0 10px #FFCC00, 0 0 20px #FFCC00, 0 0 40px #FFCC00;
            }
            /* 霓虹边框效果 */
            .neon-border-blue {
                box-shadow: 0 0 5px #00f0ff, 0 0 10px #00f0ff, inset 0 0 5px #00f0ff;
            }
            .neon-border-pink {
                box-shadow: 0 0 5px #ff2a6d, 0 0 10px #ff2a6d, inset 0 0 5px #ff2a6d;
            }
            .neon-border-green {
                box-shadow: 0 0 5px #05ffa1, 0 0 10px #05ffa1, inset 0 0 5px #05ffa1;
            }
            /* 霓虹背景渐变 */
            .neon-bg-gradient {
                background: linear-gradient(135deg);
                background-size: 400% 400%;
                animation: neonGradient 8s ease infinite;
            }
            @keyframes neonGradient {
                0% { background-position: 0% 50%; }
                50% { background-position: 100% 50%; }
                100% { background-position: 0% 50%; }
            }
            /* 字体描边效果 */
            .text-stroke {
                -webkit-text-stroke: 1px currentColor;
                color: transparent;
            }
            .text-stroke-white {
                -webkit-text-stroke: 1px white;
                color: transparent;
            }
            .text-stroke-blue {
                -webkit-text-stroke: 1px #00f0ff;
                color: transparent;
            }
            .text-stroke-pink {
                -webkit-text-stroke: 1px #ff2a6d;
                color: transparent;
            }
            /* 钉钉体/企业微信气泡样式 */
            .dingtalk-bubble {
                background: linear-gradient(135deg, rgba(0, 240, 255, 0.1), rgba(26, 26, 26, 0.8));
                border: 1px solid rgba(0, 240, 255, 0.3);
                border-radius: 12px;
                padding: 12px 16px;
                box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
                position: relative;
            }
            .dingtalk-bubble::before {
                content: '';
                position: absolute;
                bottom: -6px;
                left: 20px;
                width: 0;
                height: 0;
                border-left: 8px solid transparent;
                border-right: 8px solid transparent;
                border-top: 8px solid rgba(0, 240, 255, 0.3);
            }
            .dingtalk-bubble::after {
                content: '';
                position: absolute;
                bottom: -5px;
                left: 20px;
                width: 0;
                height: 0;
                border-left: 7px solid transparent;
                border-right: 7px solid transparent;
                border-top: 7px solid rgba(26, 26, 26, 0.8);
            }
            /* 聊天消息气泡样式 */
            .chat-bubble-left {
                background: linear-gradient(135deg, rgba(26, 26, 26, 0.8), rgba(26, 26, 26, 1));
                border: 1px solid rgba(0, 240, 255, 0.3);
                border-radius: 18px 18px 18px 4px;
            }
            .chat-bubble-right {
                background: linear-gradient(135deg, rgba(0, 240, 255, 0.2), rgba(26, 26, 26, 0.9));
                border: 1px solid rgba(0, 240, 255, 0.5);
                border-radius: 18px 18px 4px 18px;
            }
            
            /* 老虎机数字滚动动画 */
            .slot-machine {
                display: inline-block;
                position: relative;
                overflow: hidden;
                height: 1.5em;
                line-height: 1.5em;
                vertical-align: middle;
            }
            
            .slot-number {
                display: inline-block;
                position: relative;
                height: 1.5em;
                width: 0.8em;
                overflow: hidden;
                margin: 0 1px;
                background: linear-gradient(135deg, rgba(26, 26, 26, 0.8), rgba(26, 26, 26, 1));
                border: 1px solid rgba(0, 240, 255, 0.3);
                border-radius: 4px;
                box-shadow: 0 2px 8px rgba(0, 0, 0, 0.3);
            }
            
            .slot-number-inner {
                position: absolute;
                width: 100%;
                text-align: center;
                transition: transform 0.05s ease-out;
            }
            
            /* 老虎机滚动动画 */
            @keyframes slotSpin {
                0% { transform: translateY(-100%); }
                100% { transform: translateY(0); }
            }
            
            .slot-spin {
                animation: slotSpin 0.05s ease-out;
            }
            
            /* 数字滚动音效触发类 */
            .slot-number.slot-spinning {
                background: linear-gradient(135deg, rgba(0, 240, 255, 0.2), rgba(26, 26, 26, 0.9));
                box-shadow: 0 0 15px rgba(0, 240, 255, 0.5);
            }
            .animate-fade-in {
                animation: fadeIn 0.5s ease-in;
            }
            /* 渐变彩色文本效果 */
            .text-gradient {
                background: linear-gradient(90deg, #3b82f6, #8b5cf6, #ec4899, #f59e0b, #10b981);
                background-size: 400% 100%;
                -webkit-background-clip: text;
                -webkit-text-fill-color: transparent;
                background-clip: text;
                animation: gradientAnimation 8s linear infinite;
            }
            @keyframes gradientAnimation {
                0% {
                    background-position: 0% 50%;
                }
                50% {
                    background-position: 100% 50%;
                }
                100% {
                    background-position: 0% 50%;
                }
            }
            .animate-slide-up {
                animation: slideUp 0.5s ease-out;
            }
            
            /* 决策按钮交互动效 */
            #option-a, #option-b {
                transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
                overflow: visible;
                position: relative;
            }
            
            #option-a:hover, #option-b:hover {
                transform: scale(1.05) translateY(-2px);
                animation: buttonShake 0.5s infinite alternate;
            }
            
            #option-a:hover {
                box-shadow: 0 0 15px #00f0ff, 0 0 30px rgba(0, 240, 255, 0.5);
                border-color: #00f0ff !important;
            }
            
            #option-b:hover {
                box-shadow: 0 0 15px #ff2a6d, 0 0 30px rgba(255, 42, 109, 0.5);
                border-color: #ff2a6d !important;
            }
            
            @keyframes buttonShake {
                0% {
                    transform: scale(1.05) translateY(-2px) rotate(-0.5deg);
                }
                100% {
                    transform: scale(1.05) translateY(-2px) rotate(0.5deg);
                }
            }
            
            #option-a:active, #option-b:active {
                transform: scale(0.98);
                animation: none;
            }
            
            /* 金币飞溅粒子特效 */
            .coin-particle {
                position: fixed;
                pointer-events: none;
                z-index: 50;
                opacity: 0;
                animation: coinFly var(--animation-duration, 1s) forwards;
            }
            
            @keyframes coinFly {
                0% {
                    transform: scale(0) translateY(0) rotate(0deg);
                    opacity: 1;
                }
                50% {
                    opacity: 1;
                }
                100% {
                    transform: scale(1) translateY(var(--y-end)) translateX(var(--x-end)) rotate(var(--rotation));
                    opacity: 0;
                }
            }
            
            /* 漂浮梗图表情包样式 */
            .floating-meme {
                position: fixed;
                pointer-events: none;
                z-index: 1; /* 低于主要内容 */
                opacity: 0.15;
                transition: opacity 0.5s ease, transform 0.1s ease;
                animation: floatMovement var(--move-duration, 20s) ease-in-out infinite alternate;
                will-change: transform;
            }
            
            .floating-meme:hover {
                opacity: 0.3;
                pointer-events: auto;
            }
            
            /* 文字梗样式 */
            .text-meme {
                font-size: 32px;
                font-weight: bold;
                text-shadow: 0 0 10px rgba(255, 0, 255, 0.5);
            }
            
            /* 表情符号梗样式 */
            .emoji-meme {
                font-size: 48px;
            }
            
            /* 漂浮移动动画 */
            @keyframes floatMovement {
                0% {
                    transform: translate(0, 0) rotate(0deg) scale(1);
                }
                100% {
                    transform: translate(var(--target-x, 10%), var(--target-y, -10%)) rotate(var(--rotation, 30deg)) scale(var(--scale-factor, 1.1));
                }
            }
            
            .animate-pulse-slow {
                animation: pulse 3s cubic-bezier(0.4, 0, 0.6, 1) infinite;
            }
            .animate-shimmer {
                background: linear-gradient(90deg, rgba(255,255,255,0) 0%, rgba(255,255,255,0.1) 50%, rgba(255,255,255,0) 100%);
                background-size: 200% 100%;
                animation: shimmer 2s infinite;
            }
            .progress-bar {
                transition: width 0.5s ease-in-out;
                opacity: 1;
                position: relative;
                z-index: 1;
                filter: drop-shadow(0 0 3px currentColor);
            }
            .progress-bar.bg-neon-yellow {
                background-color: #FFCC00;
                color: #FFCC00;
            }
            .progress-bar.bg-neon-blue {
                background-color: #00f0ff;
                color: #00f0ff;
            }
            .progress-bar.bg-neon-pink {
                background-color: #ff2a6d;
                color: #ff2a6d;
            }
            .text-shadow {
                text-shadow: 0 2px 4px rgba(0, 0, 0, 0.3);
            }
            .border-gradient {
                position: relative;
                border-radius: 0.5rem;
            }
            .border-gradient::after {
                content: "";
                position: absolute;
                top: -2px;
                left: -2px;
                right: -2px;
                bottom: -2px;
                background: linear-gradient(45deg, #3b82f6, #8b5cf6, #ec4899, #3b82f6);
                background-size: 400%;
                border-radius: 0.6rem;
                z-index: -1;
                animation: borderAnimation 8s linear infinite;
            }
            /* 庆祝撒花动画 */
            @keyframes confetti-fall {
                0% {
                    transform: translateY(-20px) translateX(0) rotate(0deg);
                    opacity: 1;
                }
                100% {
                    transform: translateY(calc(100vh + 20px)) translateX(var(--x-offset, 0)) rotate(360deg);
                    opacity: 0;
                }
            }
            .city-skyline-bg {
                position: fixed;
                bottom: 0;
                left: 0;
                right: 0;
                height: 200px;
                background: linear-gradient(to bottom, transparent, rgba(15, 23, 42, 0.95)),
                            url('data:image/svg+xml,%3Csvg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1440 200" fill="none"%3E%3Cpath d="M0,100 L50,120 L100,80 L150,130 L200,90 L250,110 L300,70 L350,140 L400,100 L450,120 L500,80 L550,130 L600,90 L650,110 L700,70 L750,140 L800,100 L850,120 L900,80 L950,130 L1000,90 L1050,110 L1100,70 L1150,140 L1200,100 L1250,120 L1300,80 L1350,130 L1400,90 L1440,100 V200 H0 V100 Z" fill="%231e293b" opacity="0.5"/%3E%3C/svg%3E');
                background-size: cover;
                background-repeat: no-repeat;
                z-index: -1;
                opacity: 0.8;
            }
            .rising-chart-decoration {
                position: absolute;
                opacity: 0.15;
                pointer-events: none;
                z-index: 0;
            }
            .arrow-up {
                display: inline-block;
                transform: rotate(45deg);
                width: 0;
                height: 0;
                border-style: solid;
                border-width: 0 8px 8px 0;
                border-color: transparent currentColor transparent transparent;
                margin-right: 4px;
            }
            .chart-point {
                width: 8px;
                height: 8px;
                border-radius: 50%;
                display: inline-block;
                margin-right: 5px;
                box-shadow: 0 0 10px currentColor;
            }
            .glow-effect {
                box-shadow: 0 0 20px rgba(59, 130, 246, 0.5);
            }
            .water-reflection {
                position: absolute;
                bottom: -200px;
                left: 0;
                right: 0;
                height: 200px;
                background: linear-gradient(to top, rgba(15, 23, 42, 0.7), transparent);
                transform: scaleY(-1);
                opacity: 0.2;
                pointer-events: none;
                z-index: -1;
            }
        }
        
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
        
        @keyframes slideUp {
            from { transform: translateY(20px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }
        
        @keyframes pulse {
            0%, 100% {
                opacity: 1;
            }
            50% {
                opacity: 0.7;
            }
        }
        
        @keyframes shimmer {
            0% {
                background-position: -200% 0;
            }
            100% {
                background-position: 200% 0;
            }
        }
        
        @keyframes borderAnimation {
            0% {
                background-position: 0 0;
            }
            100% {
                background-position: 400% 0;
            }
        }
    </style>
</head>
<body class="bg-neutral min-h-screen font-sans text-gray-100 overflow-x-hidden relative">
    <!-- 霓虹渐变背景 -->
    <div class="fixed inset-0 bg-neutral z-0"></div>
    <div class="fixed inset-0 bg-gradient-to-br from-neon-blue/5 via-neon-pink/5 to-neon-green/5 z-0"></div>
    <div class="fixed inset-0 neon-bg-gradient opacity-50 z-0"></div>

    <!-- 城市天际线背景 - 修改为霓虹风格 -->
    <div class="city-skyline-bg z-0"></div>
    <div class="water-reflection z-0"></div>
    
    <!-- 上升趋势图表装饰 -->
    <div class="rising-chart-decoration" style="top: 10%; left: 5%; width: 200px; height: 120px;">
        <svg viewBox="0 0 200 120" xmlns="http://www.w3.org/2000/svg">
            <polyline points="10,110 30,90 50,80 70,70 90,60 110,40 130,30 150,20 170,10 190,5" 
                      stroke="#3b82f6" stroke-width="2" fill="none" stroke-dasharray="5,3"/>
            <circle cx="10" cy="110" r="3" fill="#3b82f6"/>
            <circle cx="30" cy="90" r="3" fill="#3b82f6"/>
            <circle cx="50" cy="80" r="3" fill="#3b82f6"/>
            <circle cx="70" cy="70" r="3" fill="#3b82f6"/>
            <circle cx="90" cy="60" r="3" fill="#3b82f6"/>
            <circle cx="110" cy="40" r="3" fill="#3b82f6"/>
            <circle cx="130" cy="30" r="3" fill="#3b82f6"/>
            <circle cx="150" cy="20" r="3" fill="#3b82f6"/>
            <circle cx="170" cy="10" r="3" fill="#3b82f6"/>
            <circle cx="190" cy="5" r="3" fill="#3b82f6"/>
        </svg>
    </div>
    <div class="rising-chart-decoration" style="top: 30%; right: 5%; width: 150px; height: 100px; transform: rotate(10deg);">
        <svg viewBox="0 0 150 100" xmlns="http://www.w3.org/2000/svg">
            <polyline points="10,90 25,75 40,60 55,45 70,30 85,20 100,10 115,5 130,0" 
                      stroke="#8b5cf6" stroke-width="2" fill="none" stroke-dasharray="5,3"/>
            <circle cx="10" cy="90" r="3" fill="#8b5cf6"/>
            <circle cx="25" cy="75" r="3" fill="#8b5cf6"/>
            <circle cx="40" cy="60" r="3" fill="#8b5cf6"/>
            <circle cx="55" cy="45" r="3" fill="#8b5cf6"/>
            <circle cx="70" cy="30" r="3" fill="#8b5cf6"/>
            <circle cx="85" cy="20" r="3" fill="#8b5cf6"/>
            <circle cx="100" cy="10" r="3" fill="#8b5cf6"/>
            <circle cx="115" cy="5" r="3" fill="#8b5cf6"/>
            <circle cx="130" cy="0" r="3" fill="#8b5cf6"/>
        </svg>
    </div>
    <div class="container mx-auto px-4 py-8 max-w-5xl relative z-10">
        <!-- 游戏标题 -->
        <header class="text-center mb-8 animate-fade-in relative">
            <!-- 霓虹光晕效果 -->
            <div class="absolute -top-2 -right-2 w-32 h-32 bg-neon-blue/30 rounded-full blur-3xl animate-pulse"></div>
            <div class="absolute top-10 -left-4 w-24 h-24 bg-neon-pink/30 rounded-full blur-3xl animate-pulse delay-1000"></div>
            <div class="absolute bottom-0 right-1/3 w-20 h-20 bg-neon-green/30 rounded-full blur-3xl animate-pulse delay-1500"></div>
            
            <div class="inline-block mb-2 px-4 py-1 bg-gradient-to-r from-neon-blue/30 to-neon-pink/30 rounded-full text-sm font-medium border border-neon-blue/30">
                CEO决策挑战 | 商业战略模拟
            </div>
            <h1 class="text-[clamp(2.5rem,6vw,4rem)] font-bold font-bold text-white mb-2 relative z-10 neon-glow-blue">
                <i class="fa fa-line-chart text-neon-yellow mr-2 animate-pulse-slow neon-glow-yellow"></i>
                梭哈吧！CEO
            </h1>
            <div class="dingtalk-bubble mb-6 max-w-3xl mx-auto relative z-10">
                <p class="text-white text-lg leading-relaxed">
                    在这个高风险高回报的商业世界，每一个决策都可能改变公司命运。
                    <span class="text-neon-green neon-glow-green">你能否在市场厮杀中脱颖而出，建立自己的商业帝国？</span>
                </p>
            </div>
        </header>
        
        <!-- 游戏状态面板 -->
        <div id="game-status" class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-8 animate-slide-up">
            <!-- 资金状态 -->
            <div class="bg-slate-900/80 backdrop-blur-lg rounded-xl p-5 card-shadow card-hover border-l-4 border-neon-green relative overflow-hidden hover:scale-105 transition-all duration-300 neon-border-green/20">
                <div class="absolute top-0 right-0 w-24 h-24 bg-neon-yellow opacity-10 rounded-full transform translate-x-12 -translate-y-12"></div>
                <!-- 上升趋势图表装饰 -->
                <div class="absolute bottom-5 right-5 opacity-10">
                    <svg width="60" height="40" viewBox="0 0 60 40">
                        <polyline points="5,35 15,30 25,25 35,20 45,15 55,10" 
                                  stroke="#f59e0b" stroke-width="2" fill="none"/>
                        <circle cx="5" cy="35" r="2" fill="#f59e0b"/>
                        <circle cx="15" cy="30" r="2" fill="#f59e0b"/>
                        <circle cx="25" cy="25" r="2" fill="#f59e0b"/>
                        <circle cx="35" cy="20" r="2" fill="#f59e0b"/>
                        <circle cx="45" cy="15" r="2" fill="#f59e0b"/>
                        <circle cx="55" cy="10" r="2" fill="#f59e0b"/>
                    </svg>
                </div>
                <div class="flex justify-between items-center mb-3">
                    <h3 class="font-bold text-lg flex items-center text-white  neon-glow-yellow">
                        <i class="fa fa-users text-neon-yellow mr-2"></i> 资金储备
                    </h3>
                    <span id="money-value" class="text-xl text-neon-yellow neon-glow-yellow">100/1000</span>
                </div>
                <div class="w-full bg-gray-900 rounded-full h-4 overflow-hidden border border-neon-yellow/50 shadow-lg shadow-neon-yellow/10">
                    <div id="money-bar" class="progress-bar bg-neon-yellow h-4 rounded-full animate-shimmer" style="width: 18.7%"></div>
                </div>
                <div class="text-xs text-gray-400 mt-1">
                    决定公司运营与扩张的基础
                </div>
            </div>
            <!-- 士气状态 -->
            <div class="bg-slate-900/80 backdrop-blur-lg rounded-xl p-5 card-shadow card-hover border-l-4 border-neon-blue relative overflow-hidden hover:scale-105 transition-all duration-300 neon-border-blue/20">
                <div class="absolute top-0 right-0 w-24 h-24 bg-neon-blue opacity-10 rounded-full transform translate-x-12 -translate-y-12"></div>
                <!-- 上升趋势图表装饰 -->
                <div class="absolute bottom-5 right-5 opacity-10">
                    <svg width="60" height="40" viewBox="0 0 60 40">
                        <polyline points="5,35 15,32 25,28 35,22 45,15 55,8" 
                                  stroke="#00f0ff" stroke-width="2" fill="none"/>
                        <circle cx="5" cy="35" r="2" fill="#00f0ff"/>
                        <circle cx="15" cy="32" r="2" fill="#00f0ff"/>
                        <circle cx="25" cy="28" r="2" fill="#00f0ff"/>
                        <circle cx="35" cy="22" r="2" fill="#00f0ff"/>
                        <circle cx="45" cy="15" r="2" fill="#00f0ff"/>
                        <circle cx="55" cy="8" r="2" fill="#00f0ff"/>
                    </svg>
                </div>
                <div class="flex justify-between items-center mb-3">
                    <h3 class="font-bold text-lg flex items-center text-white neon-glow-blue">
                        <i class="fa fa-users text-neon-blue mr-2"></i> 团队士气
                    </h3>
                    <span id="morale-value" class="text-xl text-neon-blue neon-glow-blue">60/1000</span>
                </div>
                <div class="w-full bg-gray-900 rounded-full h-4 overflow-hidden border border-neon-blue/50 shadow-lg shadow-neon-blue/10">
                    <div id="morale-bar" class="progress-bar bg-neon-blue h-4 rounded-full animate-shimmer" style="width: 6.8%"></div>
                </div>
                <div class="text-xs text-gray-300 mt-1">
                    人才是公司最宝贵的资产
                </div>
            </div>
            <!-- 公司前景 -->
            <div class="bg-slate-900/80 backdrop-blur-lg rounded-xl p-5 card-shadow card-hover border-l-4 border-neon-pink relative overflow-hidden hover:scale-105 transition-all duration-300 neon-border-pink/20">
                <div class="absolute top-0 right-0 w-24 h-24 bg-neon-pink opacity-10 rounded-full transform translate-x-12 -translate-y-12"></div>
                <!-- 上升趋势图表装饰 -->
                <div class="absolute bottom-5 right-5 opacity-10">
                    <svg width="60" height="40" viewBox="0 0 60 40">
                        <polyline points="5,35 15,38 25,32 35,25 45,18 55,10" 
                                  stroke="#ff2a6d" stroke-width="2" fill="none"/>
                        <circle cx="5" cy="35" r="2" fill="#ff2a6d"/>
                        <circle cx="15" cy="38" r="2" fill="#ff2a6d"/>
                        <circle cx="25" cy="32" r="2" fill="#ff2a6d"/>
                        <circle cx="35" cy="25" r="2" fill="#ff2a6d"/>
                        <circle cx="45" cy="18" r="2" fill="#ff2a6d"/>
                        <circle cx="55" cy="10" r="2" fill="#ff2a6d"/>
                    </svg>
                </div>
                <div class="flex justify-between items-center mb-3">
                    <h3 class="font-bold text-lg flex items-center text-white neon-glow-pink">
                        <i class="fa fa-line-chart text-neon-pink mr-2"></i> 公司前景
                    </h3>
                    <span id="market-value" class="text-xl text-neon-pink neon-glow-pink">40/1000</span>
                </div>
                <div class="w-full bg-gray-900 rounded-full h-4 overflow-hidden border border-neon-pink/50 shadow-lg shadow-neon-pink/10">
                    <div id="market-bar" class="progress-bar bg-neon-pink h-4 rounded-full animate-shimmer" style="width: 1.2%"></div>
                </div>
                <div class="text-xs text-gray-300 mt-1">
                    决定公司未来发展潜力
                </div>
            </div>
        </div>
        
        <!-- 剧情进度 -->
        <div class="bg-slate-900/80 backdrop-blur-lg rounded-xl p-5 mb-8 card-shadow animate-slide-up neon-border-blue/20 border border-neon-blue/30">
            <div class="flex justify-between items-center mb-3">
                <h3 class="font-bold text-lg flex items-center text-white neon-glow-blue">
                    <i class="fa fa-trophy text-neon-green mr-2"></i> 商业征程
                </h3>
                <span id="story-stage" class="text-xl text-neon-green neon-glow-green">初创阶段 (1.0/5)</span>
            </div>
            <div class="w-full bg-gray-900 rounded-full h-4 overflow-hidden border border-gray-700/50 shadow-lg shadow-gray-700/10">
                <div id="story-bar" class="progress-bar bg-gradient-to-r from-neon-blue via-neon-pink to-neon-green h-4 rounded-full animate-shimmer" style="width: 20%"></div>
            </div>
            <div class="flex justify-between text-xs text-gray-300 mt-2">
                <span class="text-neon-blue">公司成立</span>
                <span>高速增长</span>
                <span>市场扩张</span>
                <span>行业领导者</span>
                <span class="text-neon-green">商业帝国</span>
            </div>
        </div>
        
        <!-- 游戏开始界面 -->
        <div id="start-screen" class="bg-neutral-light rounded-xl p-10 text-center card-shadow mb-8 animate-fade-in relative overflow-hidden border-gradient">
            <!-- 背景装饰 -->
            <div class="absolute inset-0 bg-business-pattern opacity-20"></div>
            <div class="absolute top-0 right-0 w-64 h-64 bg-primary opacity-5 rounded-full transform translate-x-32 -translate-y-32"></div>
            <div class="absolute bottom-0 left-0 w-64 h-64 bg-secondary opacity-5 rounded-full transform -translate-x-32 translate-y-32"></div>
            <!-- 城市天际线装饰 -->
            <div class="absolute bottom-0 left-0 right-0 h-32 opacity-10">
                <svg viewBox="0 0 1000 100" xmlns="http://www.w3.org/2000/svg">
                    <path d="M0,70 L50,50 L100,70 L150,30 L200,60 L250,40 L300,70 L350,20 L400,50 L450,60 L500,30 L550,50 L600,40 L650,60 L700,20 L750,40 L800,60 L850,30 L900,50 L950,40 L1000,60 V100 H0 V70 Z" fill="#3b82f6"/>
                </svg>
            </div>
            
            <div class="relative">
                <h2 class="text-3xl font-bold text-white mb-6 text-shadow">
                    <span>霸总</span>
                    <span id="player-name" class="font-bold text-[120%] text-gradient cursor-pointer hover:underline">？？？</span>
                    <span>的商业帝国</span>
                </h2>
                <!-- 玩家姓名设置区域 -->
                <div id="name-setting-area" class="mb-8 bg-gray-800/70 p-6 rounded-xl border-l-4 border-primary">
                    <h3 class="text-xl font-semibold text-white mb-4 flex items-center">
                        <i class="fa fa-user-circle text-primary mr-2"></i> 选择您的CEO身份
                    </h3>
                    <div class="flex flex-col md:flex-row gap-4 items-center">
                        <div class="flex-grow">
                            <input type="text" id="player-name-input" 
                                   class="w-full px-4 py-3 bg-gray-700 border border-gray-600 rounded-lg text-white focus:outline-none focus:ring-2 focus:ring-primary focus:border-transparent transition-all"
                                   placeholder="请输入您的姓名，或点击右方按钮随机选择" maxlength="10">
                        </div>
                        <button id="random-name-btn" class="bg-secondary hover:bg-secondary/90 text-white font-medium py-3 px-6 rounded-lg transition-all transform hover:scale-105 focus:outline-none shadow-md">
                            <i class="fa fa-random mr-2"></i> 随机选择
                        </button>
                    </div>
                    <div class="mt-4 text-sm text-gray-400">
                        <i class="fa fa-info-circle mr-1"></i> 点击姓名区域也可直接修改
                    </div>
                </div>
                <div class="max-w-2xl mx-auto mb-8">
                    <p class="text-gray-300 mb-4 leading-relaxed">
                        <span class="text-primary font-semibold">你是一位雄心勃勃的企业家</span>，刚刚创立了一家科技公司。
                        在这个<span class="text-warning font-semibold">竞争激烈的市场</span>中，每一个决策都至关重要。
                    </p>
                    <p class="text-gray-300 mb-4 leading-relaxed">
                        你需要在<span class="text-success font-semibold">资源有限</span>的情况下，平衡短期利益与长期发展，
                        应对来自<span class="text-danger font-semibold">竞争对手、投资者、员工和市场</span>的多重压力。
                    </p>
                    <p class="text-gray-300 leading-relaxed">
                        你的目标是将这家<span class="text-secondary font-semibold">初创公司</span>发展成为<span class="text-primary font-semibold">行业巨头</span>，
                        最终实现<span class="text-warning font-semibold">成功上市或被高价收购</span>的商业传奇！
                    </p>
                </div>
                <button id="start-game-btn" class="bg-gradient-to-r from-primary to-secondary text-white font-bold py-4 px-10 rounded-lg transition-all transform hover:scale-105 focus:outline-none shadow-lg hover:shadow-primary/20 border-gradient relative overflow-hidden group">
                    <span class="relative z-10 flex items-center">
                        <i class="fa fa-rocket mr-2"></i> 开启商业征程
                    </span>
                    <!-- 上升箭头装饰 -->
                    <div class="absolute -right-10 -bottom-10 opacity-20 group-hover:opacity-40 transition-opacity duration-300">
                        <svg width="80" height="80" viewBox="0 0 100 100">
                            <path d="M50,10 L80,60 L50,50 L20,60 Z" fill="white"/>
                            <polyline points="50,10 50,90" stroke="white" stroke-width="4" fill="none"/>
                        </svg>
                    </div>
                </button>
                <p class="text-gray-400 text-sm mt-4">
                    <i class="fa fa-info-circle mr-1"></i> 每次决策都将影响公司命运
                </p>
            </div>
        </div>
        
        <!-- 董事会会议界面 -->
        <div id="meeting-screen" class="hidden bg-neutral-light rounded-xl p-8 card-shadow mb-8 animate-fade-in relative overflow-hidden">
            <!-- 背景装饰 -->
            <div class="absolute inset-0 bg-business-pattern opacity-10"></div>
            
            <div class="relative">
                <div class="mb-8">
                    <div class="flex items-center justify-between mb-6">
                        <h2 id="meeting-title" class="text-2xl font-bold text-white">第1次董事会会议</h2>
                        <div class="bg-gray-700 text-gray-300 px-3 py-1 rounded-full text-sm">
                            <i class="fa fa-clock-o mr-1"></i>
                            <span id="meeting-time">关键决策时刻</span>
                        </div>
                    </div>
                    
                    <div class="p-6 bg-gray-800/50 rounded-xl border-l-4 border-primary mb-6 relative">
                        <div class="absolute top-3 right-3 text-primary opacity-30">
                            <i class="fa fa-commenting text-3xl"></i>
                        </div>
                        <p id="meeting-description" class="text-gray-200 leading-relaxed italic relative z-10">
                            <!-- 董事会描述将在这里显示 -->
                        </p>
                    </div>
                    
                    <div class="bg-danger/10 border border-danger/20 rounded-lg p-4 mb-8">
                        <h3 class="font-bold text-xl text-danger mb-2 flex items-center">
                            <i class="fa fa-exclamation-triangle mr-2"></i> 战略抉择时刻
                        </h3>
                        <p id="meeting-dilemma" class="text-gray-300">
                            <!-- 困境描述将在这里显示 -->
                        </p>
                    </div>
                </div>
                
                <div class="grid grid-cols-1 md:grid-cols-2 gap-8 mb-4">
                    <!-- 选项A -->
                    <div class="bg-gray-800 rounded-xl p-6 transition-all cursor-pointer transform hover:scale-[1.02] hover:shadow-lg border-2 border-transparent hover:border-primary relative overflow-hidden group" id="option-a">
                        <div class="absolute inset-0 bg-gradient-to-r from-primary/10 to-transparent opacity-0 group-hover:opacity-100 transition-opacity duration-300"></div>
                        <div class="absolute top-0 left-0 w-full h-1 bg-primary"></div>
                        <div class="flex items-center mb-4">
                            <div class="w-10 h-10 rounded-full bg-primary/20 flex items-center justify-center text-primary mr-3">
                                <span class="font-bold">A</span>
                            </div>
                            <h3 class="text-xl font-bold text-white">激进战略</h3>
                        </div>
                        <p class="text-gray-300 leading-relaxed relative z-10" id="option-a-text">
                            <!-- 选项A描述将在这里显示 -->
                        </p>
                        <div class="mt-4 text-xs text-gray-400">
                            <i class="fa fa-lightbulb-o mr-1"></i> 高风险高回报策略
                        </div>
                    </div>
                    
                    <!-- 选项B -->
                    <div class="bg-gray-800 rounded-xl p-6 transition-all cursor-pointer transform hover:scale-[1.02] hover:shadow-lg border-2 border-transparent hover:border-secondary relative overflow-hidden group" id="option-b">
                        <div class="absolute inset-0 bg-gradient-to-r from-secondary/10 to-transparent opacity-0 group-hover:opacity-100 transition-opacity duration-300"></div>
                        <div class="absolute top-0 left-0 w-full h-1 bg-secondary"></div>
                        <div class="flex items-center mb-4">
                            <div class="w-10 h-10 rounded-full bg-secondary/20 flex items-center justify-center text-secondary mr-3">
                                <span class="font-bold">B</span>
                            </div>
                            <h3 class="text-xl font-bold text-white">稳健战略</h3>
                        </div>
                        <p class="text-gray-300 leading-relaxed relative z-10" id="option-b-text">
                            <!-- 选项B描述将在这里显示 -->
                        </p>
                        <div class="mt-4 text-xs text-gray-400">
                            <i class="fa fa-shield mr-1"></i> 低风险可持续发展策略
                        </div>
                    </div>
                </div>
                
                <div class="text-center text-gray-500 text-sm">
                    <i class="fa fa-balance-scale mr-1"></i> 权衡利弊，做出明智决策
                </div>
            </div>
        </div>
        
        <!-- 决策反馈界面 -->
        <div id="feedback-screen" class="hidden bg-neutral-light rounded-xl p-8 card-shadow mb-8 animate-fade-in relative overflow-hidden">
            <!-- 背景装饰 -->
            <div class="absolute inset-0 bg-business-pattern opacity-10"></div>
            <div class="absolute top-0 right-0 w-64 h-64 bg-primary opacity-5 rounded-full transform translate-x-32 -translate-y-32"></div>
            
            <div class="relative">
                <h2 class="text-2xl font-bold text-white mb-6 flex items-center">
                    <i class="fa fa-line-chart text-secondary mr-3"></i> 董事会决议反馈
                </h2>
                <div id="feedback-text" class="text-gray-200 bg-gray-800/70 p-5 rounded-xl border-l-4 border-secondary mb-8 text-lg leading-relaxed">
                    <!-- 反馈文本将在这里显示 -->
                </div>
                
                <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
                    <div class="bg-gray-800 rounded-xl p-5 card-shadow card-hover border-l-4 border-warning relative overflow-hidden">
                        <div class="absolute top-0 right-0 w-16 h-16 bg-warning opacity-10 rounded-full transform translate-x-8 -translate-y-8"></div>
                        <h4 class="text-sm font-medium text-gray-400 mb-2">资金变化</h4>
                        <p id="money-change" class="text-2xl font-bold text-warning">
                            <!-- 资金变化将在这里显示 -->
                        </p>
                    </div>
                    <div class="bg-gray-800 rounded-xl p-5 card-shadow card-hover border-l-4 border-success relative overflow-hidden">
                        <div class="absolute top-0 right-0 w-16 h-16 bg-success opacity-10 rounded-full transform translate-x-8 -translate-y-8"></div>
                        <h4 class="text-sm font-medium text-gray-400 mb-2">士气变化</h4>
                        <p id="morale-change" class="text-2xl font-bold text-success">
                            <!-- 士气变化将在这里显示 -->
                        </p>
                    </div>
                    <div class="bg-gray-800 rounded-xl p-5 card-shadow card-hover border-l-4 border-primary relative overflow-hidden">
                        <div class="absolute top-0 right-0 w-16 h-16 bg-primary opacity-10 rounded-full transform translate-x-8 -translate-y-8"></div>
                        <h4 class="text-sm font-medium text-gray-400 mb-2">公司前景变化</h4>
                        <p id="market-change" class="text-2xl font-bold text-primary">
                            <!-- 公司前景变化将在这里显示 -->
                        </p>
                    </div>
                </div>
                
                <button id="continue-btn" class="bg-gradient-to-r from-primary to-secondary text-white font-bold py-3 px-8 rounded-lg transition-all transform hover:scale-105 focus:outline-none shadow-lg hover:shadow-primary/20 border-gradient">
                    <i class="fa fa-arrow-right mr-2"></i> 继续商业征程
                </button>
            </div>
        </div>
        
        <!-- 游戏结局界面 -->
        <div id="ending-screen" class="hidden max-w-4xl mx-auto">
            <div class="bg-neutral-light rounded-xl p-8 card-shadow mb-6 relative overflow-hidden">
                <!-- 背景装饰 -->
                <div class="absolute inset-0 bg-business-pattern opacity-10"></div>
                <div class="absolute top-0 right-0 w-64 h-64 bg-primary opacity-5 rounded-full transform translate-x-32 -translate-y-32"></div>
                <div class="absolute bottom-0 left-0 w-64 h-64 bg-secondary opacity-5 rounded-full transform -translate-x-32 translate-y-32"></div>
                
                <div class="relative">
                    <h2 id="ending-title" class="text-3xl font-bold mb-6 text-white"></h2>
                    <p id="ending-text" class="text-xl text-gray-300 mb-8 leading-relaxed"></p>
                    
                    <!-- 标签页切换 -->
                    <div class="flex mb-8 flex-wrap gap-4" style="will-change: transform;">
                        <button id="report-card-tab" class="bg-gradient-to-r from-primary to-secondary text-white py-3 px-6 font-medium rounded-lg shadow-md hover:shadow-lg transition-all transform hover:scale-[1.02] flex items-center">
                            <i class="fa fa-chart-bar mr-2"></i> 成绩单
                        </button>
                        <button id="history-tab" class="bg-gray-800 text-gray-300 py-3 px-6 font-medium rounded-lg shadow-md hover:shadow-lg transition-all transform hover:scale-[1.02] flex items-center">
                            <i class="fa fa-history mr-2"></i> 历史记录
                        </button>
                        <button id="leaderboard-tab" class="bg-gray-800 text-gray-300 py-3 px-6 font-medium rounded-lg shadow-md hover:shadow-lg transition-all transform hover:scale-[1.02] flex items-center">
                            <i class="fa fa-trophy mr-2"></i> 排行榜
                        </button>
                    </div>
                    
                    <!-- 成绩单内容 -->
                    <div id="report-card-content" class="mb-8">
                        <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
                            <div class="bg-gray-800 rounded-xl p-6 card-shadow card-hover text-center relative overflow-hidden border-l-4 border-primary">
                                <div class="absolute top-0 right-0 w-16 h-16 bg-primary opacity-10 rounded-full transform translate-x-8 -translate-y-8"></div>
                                <p class="text-gray-400 mb-3">决策次数</p>
                                <h3 id="total-decisions" class="text-4xl font-bold text-primary">0</h3>
                            </div>
                            <div class="bg-gray-800 rounded-xl p-6 card-shadow card-hover text-center relative overflow-hidden border-l-4 border-secondary">
                                <div class="absolute top-0 right-0 w-16 h-16 bg-secondary opacity-10 rounded-full transform translate-x-8 -translate-y-8"></div>
                                <p class="text-gray-400 mb-3">最终得分</p>
                                <h3 id="final-score" class="text-4xl font-bold text-secondary">0</h3>
                            </div>
                            <div class="bg-gray-800 rounded-xl p-6 card-shadow card-hover text-center relative overflow-hidden border-l-4 border-warning">
                                <div class="absolute top-0 right-0 w-16 h-16 bg-warning opacity-10 rounded-full transform translate-x-8 -translate-y-8"></div>
                                <p class="text-gray-400 mb-3">等级评定</p>
                                <h3 id="final-grade" class="text-5xl font-bold text-warning w-full flex items-center justify-center">S</h3>
                            </div>
                        </div>
                        <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
                            <div class="bg-gray-800 rounded-xl p-5 card-shadow card-hover text-center relative overflow-hidden border-l-4 border-warning">
                                <div class="absolute top-0 right-0 w-16 h-16 bg-warning opacity-10 rounded-full transform translate-x-8 -translate-y-8"></div>
                                <p class="text-gray-400 mb-2">资金状况</p>
                                <h4 id="money-score" class="text-3xl font-bold text-warning">0/1000</h4>
                            </div>
                            <div class="bg-gray-800 rounded-xl p-5 card-shadow card-hover text-center relative overflow-hidden border-l-4 border-success">
                                <div class="absolute top-0 right-0 w-16 h-16 bg-success opacity-10 rounded-full transform translate-x-8 -translate-y-8"></div>
                                <p class="text-gray-400 mb-2">团队士气</p>
                                <h4 id="morale-score" class="text-3xl font-bold text-success">0/1000</h4>
                            </div>
                            <div class="bg-gray-800 rounded-xl p-5 card-shadow card-hover text-center relative overflow-hidden border-l-4 border-primary">
                                <div class="absolute top-0 right-0 w-16 h-16 bg-primary opacity-10 rounded-full transform translate-x-8 -translate-y-8"></div>
                                <p class="text-gray-400 mb-2">公司前景</p>
                                <h4 id="market-score" class="text-3xl font-bold text-primary">0/1000</h4>
                            </div>
                        </div>
                        <div class="bg-gray-800 rounded-xl p-6 card-shadow">
                            <h4 class="font-bold text-xl text-white mb-6 flex items-center">
                                <i class="fa fa-line-chart text-primary mr-3"></i> 公司发展趋势
                            </h4>
                            <div class="h-80">
                                <canvas id="history-chart"></canvas>
                            </div>
                        </div>
                    </div>
                    
                    <!-- 历史记录内容 -->
                    <div id="history-content" class="hidden">
                        <div class="mb-8">
                            <h4 class="font-bold text-xl text-white mb-6 flex items-center">
                                <i class="fa fa-sitemap text-secondary mr-3"></i> 公司发展历程时间线
                            </h4>
                            <div id="history-timeline" class="space-y-2">
                                <!-- 历史记录时间线将通过JavaScript动态生成 -->
                            </div>
                        </div>
                    </div>
                    
                    <!-- 排行榜内容 -->
                    <div id="leaderboard-content" class="hidden">
                        <div class="bg-gray-800 rounded-xl p-6 card-shadow">
                            <h4 class="font-bold text-xl text-white mb-6 flex items-center">
                                <i class="fa fa-trophy text-yellow-500 mr-3"></i> 玩家排行榜
                            </h4>
                            <div id="leaderboard-table-container" class="overflow-x-auto">
                                <div id="leaderboard-loading" class="text-center py-12 text-gray-400">
                                    <i class="fa fa-circle-o-notch fa-spin text-2xl mb-4"></i>
                                    <p>加载排行榜数据...</p>
                                </div>
                                <table id="leaderboard-table" class="w-full text-left hidden">
                                    <thead>
                                        <tr class="border-b border-gray-700">
                                            <th class="py-3 px-4 text-gray-400">排名</th>
                                            <th class="py-3 px-4 text-gray-400">玩家</th>
                                            <th class="py-3 px-4 text-gray-400">最终得分</th>
                                            <th class="py-3 px-4 text-gray-400">等级评定</th>
                                            <th class="py-3 px-4 text-gray-400">游戏时间</th>
                                        </tr>
                                    </thead>
                                    <tbody id="leaderboard-body">
                                        <!-- 排行榜数据将通过JavaScript动态生成 -->
                                    </tbody>
                                </table>
                                <div id="leaderboard-empty" class="text-center py-12 text-gray-400 hidden">
                                    <i class="fa fa-trophy text-2xl mb-4 opacity-30"></i>
                                    <p>暂无历史记录，开始游戏创造你的传奇吧！</p>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <button id="restart-btn" class="bg-gradient-to-r from-primary to-secondary text-white font-bold py-4 px-10 rounded-lg transition-all transform hover:scale-105 focus:outline-none shadow-lg hover:shadow-primary/20 border-gradient flex items-center mx-auto block">
                        <i class="fa fa-refresh mr-2"></i> 重新开始商业征程
                    </button>
                </div>
            </div>
        </div>
    </div>
    
    <script>
        // 预设姓名名单
        const presetNames = [
            { name: '司马草台', desc: '草台班子话事人，表面霸总，实则螺丝刀揣兜，随时准备搭台子' },
            { name: '投行牛马🐂', desc: '哞~~~~人未至，班味先行。衬衫永远塞进西裤，保温杯泡枸杞' },
            { name: '慕容偷感🐀', desc: '吱吱——走路贴墙根，开会坐角落，身家百亿但永远像偷溜进公司的' },
            { name: '金融吗喽🐒', desc: '吗喽文学代言人，办公室挂横幅："今天也要开开心心当猴子"' },
            { name: '大胖橘🐱', desc: '哈基咪！吃饭必配电子榨菜，开会放《甄嬛传》，董事会叫"甄嬛传十级学者研讨会"' },
            { name: '高雅人士🐧', desc: '明月几时有~~~~把酒问青天~~~·' },
            { name: '独孤窝囊🐶', desc: '对外狂霸酷炫拽，对内员工请假秒批："行吧行吧你开心就好"' },
            { name: '西门疯批', desc: '发疯组组长，凌晨三点在群里发60秒语音方阵，第二天说发错了' },
            { name: '上官拿捏', desc: '什么都想拿捏，但只拿捏住了公司楼下的保安和保洁阿姨' }
        ];

        // 添加全局错误处理
        window.addEventListener('error', function(event) {
            console.error('Global Error:', event.message, 'at line', event.lineno, 'in', event.filename);
            console.log('Game State at Error:', { playerName: gameState?.playerName, game_over: gameState?.game_over });
        });

        // 创建日志记录工具
        const logger = {
            info: function(message, data = {}) {
                console.log(`[INFO] ${message}`, data);
            },
            warn: function(message, data = {}) {
                console.warn(`[WARN] ${message}`, data);
            },
            error: function(message, data = {}) {
                console.error(`[ERROR] ${message}`, data);
            },
            playerName: function(action, name, source) {
                console.log(`[PLAYER_NAME] ${action}: "${name}" from ${source}`);
            }
        };

        // 初始化音效系统
        const soundEffects = {
            click: new Audio('/static/sounds/click.mp3'),
            success: new Audio('/static/sounds/success.mp3'),
            error: new Audio('/static/sounds/error.mp3'),
            notification: new Audio('/static/sounds/notification.mp3'),
            slotSpin: new Audio('/static/sounds/slot-spin.mp3'),
            allIn: new Audio('/static/sounds/all-in.mp3')
        };
        
        // 预加载音效
        Object.values(soundEffects).forEach(sound => {
            sound.load();
        });
        
        // 播放音效的函数
        function playSound(type) {
            if (soundEffects[type]) {
                soundEffects[type].currentTime = 0;
                soundEffects[type].play().catch(e => console.log('无法播放音效:', e));
            }
        }
        
        // 播放梭哈语音音效
        function playAllInSound() {
            // 如果有专门的梭哈音效，优先使用
            if (soundEffects.allIn) {
                soundEffects.allIn.currentTime = 0;
                soundEffects.allIn.play().catch(e => console.log('无法播放梭哈音效:', e));
            } else {
                // 否则使用点击音效作为后备
                playSound('click');
            }
        }
        
        // 创建金币飞溅粒子特效
        function createCoinParticles(x, y) {
            const particleCount = 20;
            const coins = ['💰', '🪙', '💸', '🏆'];
            
            for (let i = 0; i < particleCount; i++) {
                const particle = document.createElement('div');
                const coin = coins[Math.floor(Math.random() * coins.length)];
                
                particle.className = 'coin-particle';
                particle.textContent = coin;
                particle.style.left = `${x}px`;
                particle.style.top = `${y}px`;
                
                // 随机属性
                const size = Math.random() * 24 + 16;
                const duration = Math.random() * 1 + 0.5;
                const angle = Math.random() * Math.PI * 2;
                const distance = Math.random() * 100 + 50;
                const xEnd = Math.cos(angle) * distance;
                const yEnd = -Math.sin(angle) * distance;
                const rotation = Math.random() * 720;
                
                particle.style.fontSize = `${size}px`;
                particle.style.setProperty('--animation-duration', `${duration}s`);
                particle.style.setProperty('--x-end', `${xEnd}px`);
                particle.style.setProperty('--y-end', `${yEnd}px`);
                particle.style.setProperty('--rotation', `${rotation}deg`);
                
                // 随机颜色效果
                const colors = ['text-yellow-300', 'text-amber-400', 'text-yellow-500', 'text-amber-300'];
                particle.classList.add(colors[Math.floor(Math.random() * colors.length)]);
                
                document.body.appendChild(particle);
                
                // 动画结束后移除粒子
                setTimeout(() => {
                    particle.remove();
                }, duration * 1000);
            }
        }

        // 游戏状态管理
        let gameState = {
            money: 100,
            morale: 60,
            market_prospect: 40,
            story_stage: 1.0,
            game_over: false,
            game_over_saved: false, // 新增：用于防止重复保存游戏记录
            history: [],
            playerName: localStorage.getItem('lastPlayerName') || '？？？'
        };
        
        // 初始日志记录
        logger.playerName('Initialization', gameState.playerName, 'localStorage or default')
        
        // 背景漂浮梗图表情包管理
        const backgroundMemes = {
            // 表情符号数组
            emojis: ['💰', '🤑', '🤩', '💪', '🔥', '💎', '🚀', '🎉', '🎊', '💸', '👑', '🏆'],
            
            // 文字梗数组
            textMemes: ['我全都要', '就这？', '梭哈！', '暴富！', '财务自由', '一夜暴富', '我太南了', '奥利给'],
            
            // 生成随机位置，优化分布使其更加分散
            getRandomPosition() {
                // 使用稍微偏均匀分布的位置生成
                // 避免梗图过度集中在中心
                const randomOffset = () => Math.pow(Math.random(), 1.2) * 100;
                return {
                    x: randomOffset(),
                    y: randomOffset()
                };
            },
            
            // 生成随机大小
            getRandomSize() {
                return Math.random() * 30 + 24; // 增大尺寸范围，现在是24-54px
            },
            
            // 生成随机移动时间
            getRandomDuration() {
                return Math.random() * 20 + 15; // 15-35秒
            },
            
            // 创建漂浮元素
            createFloatingElement() {
                const container = document.createElement('div');
                container.className = 'floating-meme';
                
                // 随机选择是表情符号还是文字梗
                const isEmoji = Math.random() > 0.3;
                
                if (isEmoji) {
                    container.className += ' emoji-meme';
                    container.textContent = this.emojis[Math.floor(Math.random() * this.emojis.length)];
                } else {
                    container.className += ' text-meme';
                    container.textContent = this.textMemes[Math.floor(Math.random() * this.textMemes.length)];
                    
                    // 随机颜色
                    const colors = ['text-pink-500', 'text-blue-500', 'text-green-500', 'text-yellow-500', 'text-purple-500'];
                    container.classList.add(colors[Math.floor(Math.random() * colors.length)]);
                }
                
                // 设置初始位置
                const pos = this.getRandomPosition();
                container.style.left = `${pos.x}%`;
                container.style.top = `${pos.y}%`;
                container.style.fontSize = `${this.getRandomSize()}px`;
                
                // 添加到文档中
                document.body.appendChild(container);
                
                // 开始移动动画
                this.animateElement(container);
                
                // 设置移除和重新创建的定时器
                setTimeout(() => {
                    // 淡出效果
                    container.style.opacity = '0';
                    setTimeout(() => {
                        container.remove();
                        this.createFloatingElement(); // 创建新的元素
                    }, 1000);
                }, this.getRandomDuration() * 1000);
            },
            
            // 动画函数
            animateElement(element) {
                const moveElement = () => {
                    const newPos = this.getRandomPosition();
                    const duration = this.getRandomDuration();
                    
                    // 设置CSS变量用于动画
                    element.style.setProperty('--target-x', `${newPos.x}%`);
                    element.style.setProperty('--target-y', `${newPos.y}%`);
                    element.style.setProperty('--move-duration', `${duration}s`);
                    
                    // 触发动画
                    element.style.transform = 'translate(var(--target-x), var(--target-y)) rotate(var(--rotation))';
                    
                    // 随机旋转
                    const rotation = Math.random() * 360 - 180;
                    element.style.setProperty('--rotation', `${rotation}deg`);
                    
                    // 递归调用，持续移动
                    setTimeout(moveElement, duration * 1000);
                };
                
                // 初始化动画
                moveElement();
            },
            
            // 初始化背景梗图
            init() {
                // 创建多个漂浮元素，减少密度并增加间隔
                for (let i = 0; i < 10; i++) {
                    setTimeout(() => {
                        this.createFloatingElement();
                    }, Math.random() * 3000);
                }
            }
        };

        // 初始化所有视觉效果
        document.addEventListener('DOMContentLoaded', function() {
            // 为现有资源数字应用老虎机样式
            setTimeout(() => {
                const moneyValue = document.getElementById('money-value');
                const moraleValue = document.getElementById('morale-value');
                const marketValue = document.getElementById('market-value');
                
                if (moneyValue) animateSlotNumber(moneyValue, gameState.money, 1000);
                if (moraleValue) animateSlotNumber(moraleValue, gameState.morale, 1000);
                if (marketValue) animateSlotNumber(marketValue, gameState.market_prospect, 1000);
            }, 500);
            
            // 初始化背景漂浮梗图表情包
            backgroundMemes.init();
        });
        
        // 图表实例
        let historyChart = null;
        
        // DOM元素
        const startScreen = document.getElementById('start-screen');
        const meetingScreen = document.getElementById('meeting-screen');
        const feedbackScreen = document.getElementById('feedback-screen');
        const endingScreen = document.getElementById('ending-screen');
        const startGameBtn = document.getElementById('start-game-btn');
        const continueBtn = document.getElementById('continue-btn');
        const restartBtn = document.getElementById('restart-btn');
        const optionA = document.getElementById('option-a');
        const optionB = document.getElementById('option-b');
        const playerNameElement = document.getElementById('player-name');
        const playerNameInput = document.getElementById('player-name-input');
        const randomNameBtn = document.getElementById('random-name-btn');
        
        // 初始化时加载并显示玩家姓名
        if (gameState.playerName !== '？？？') {
            playerNameElement.textContent = gameState.playerName;
            playerNameInput.value = gameState.playerName;
        }
        
        // 老虎机数字滚动动画函数
        function animateSlotNumber(element, targetNumber, total = 1000) {
            // 检查元素是否已包含老虎机结构
            if (element.querySelector('.slot-machine')) {
                // 移除旧的老虎机结构
                while (element.firstChild) {
                    element.removeChild(element.firstChild);
                }
            }
            
            // 创建老虎机容器
            const slotContainer = document.createElement('div');
            slotContainer.className = 'slot-machine';
            
            // 创建每个数字的老虎机位
            const digits = targetNumber.toString().split('');
            const slotElements = [];
            
            digits.forEach((digit, index) => {
                // 添加千位分隔符
                if (index > 0 && (digits.length - index) % 3 === 0) {
                    const comma = document.createElement('span');
                    comma.textContent = ',';
                    comma.className = 'mx-0.5 text-white';
                    slotContainer.appendChild(comma);
                }
                
                const slotNumber = document.createElement('div');
                slotNumber.className = 'slot-number';
                
                const slotInner = document.createElement('div');
                slotInner.className = 'slot-number-inner';
                slotInner.textContent = digit;
                
                slotNumber.appendChild(slotInner);
                slotContainer.appendChild(slotNumber);
                slotElements.push(slotNumber);
            });
            
            // 添加分母
            const denominator = document.createElement('span');
            denominator.textContent = `/${total}`;
            denominator.className = 'text-white';
            slotContainer.appendChild(denominator);
            
            // 将老虎机容器添加到元素中
            element.appendChild(slotContainer);
            
            // 播放滚动动画
            let delay = 0;
            slotElements.forEach((slot, index) => {
                setTimeout(() => {
                    // 随机滚动次数
                    const rollCount = Math.floor(Math.random() * 3) + 2;
                    let currentRoll = 0;
                    
                    const rollInterval = setInterval(() => {
                        // 添加旋转类和发光效果
                        slot.classList.add('slot-spinning');
                        
                        // 播放音效
                        playSound('slotSpin');
                        
                        // 更新数字为随机数
                        const randomDigit = Math.floor(Math.random() * 10);
                        slot.querySelector('.slot-number-inner').textContent = randomDigit;
                        
                        currentRoll++;
                        if (currentRoll >= rollCount) {
                            // 最后一次滚动到目标数字
                            clearInterval(rollInterval);
                            slot.querySelector('.slot-number-inner').textContent = digits[index];
                            
                            // 移除发光效果
                            setTimeout(() => {
                                slot.classList.remove('slot-spinning');
                            }, 100);
                        }
                    }, 50);
                }, delay);
                
                // 错开每个数字的动画开始时间
                delay += 100;
            });
        }
        
        // 更新游戏状态显示
        function updateGameStatus() {
            const moneyValue = document.getElementById('money-value');
            const moraleValue = document.getElementById('morale-value');
            const marketValue = document.getElementById('market-value');
            const storyStage = document.getElementById('story-stage');
            
            const moneyBar = document.getElementById('money-bar');
            const moraleBar = document.getElementById('morale-bar');
            const marketBar = document.getElementById('market-bar');
            const storyBar = document.getElementById('story-bar');
            
            // 应用老虎机数字滚动动画
            animateSlotNumber(moneyValue, gameState.money, 1000);
            animateSlotNumber(moraleValue, gameState.morale, 1000);
            animateSlotNumber(marketValue, gameState.market_prospect, 1000);
            storyStage.textContent = `${gameState.story_stage.toFixed(1)}/5`;
            
            moneyBar.style.width = `${gameState.money}%`;
            moraleBar.style.width = `${gameState.morale}%`;
            marketBar.style.width = `${gameState.market_prospect}%`;
            storyBar.style.width = `${(gameState.story_stage / 5) * 100}%`;
            
            // 添加颜色变化效果
            if (gameState.money < 20) moneyBar.classList.add('bg-danger');
            else moneyBar.classList.remove('bg-danger');
            
            if (gameState.morale < 20) moraleBar.classList.add('bg-danger');
            else moraleBar.classList.remove('bg-danger');
            
            if (gameState.market_prospect < 20) marketBar.classList.add('bg-danger');
            else marketBar.classList.remove('bg-danger');
        }

        // 随机选择姓名
        function selectRandomName() {
            const randomIndex = Math.floor(Math.random() * presetNames.length);
            const selectedName = presetNames[randomIndex];
            gameState.playerName = selectedName.name;
            
            // 更新显示
            playerNameElement.textContent = selectedName.name;
            playerNameInput.value = selectedName.name;
            
            // 保存到本地存储
            localStorage.setItem('lastPlayerName', selectedName.name);
            
            // 显示提示信息
            showTooltip(selectedName.desc);
        }

        // 显示提示信息
        function showTooltip(message) {
            // 创建提示元素
            let tooltip = document.getElementById('name-tooltip');
            if (!tooltip) {
                tooltip = document.createElement('div');
                tooltip.id = 'name-tooltip';
                tooltip.className = 'fixed top-20 left-1/2 transform -translate-x-1/2 bg-black/80 text-white py-2 px-4 rounded-lg z-50 animate-fade-in';
                document.body.appendChild(tooltip);
            }
            
            tooltip.textContent = message;
            tooltip.classList.remove('hidden');
            
            // 3秒后隐藏
            setTimeout(() => {
                tooltip.classList.add('animate-fade-out');
                setTimeout(() => {
                    tooltip.classList.add('hidden');
                    tooltip.classList.remove('animate-fade-out');
                }, 300);
            }, 3000);
        }

        // 设置姓名输入事件
        function setupNameInputEvents() {
            // 点击姓名区域
            playerNameElement.addEventListener('click', function() {
                playerNameInput.focus();
                playerNameInput.value = gameState.playerName;
            });
            
            // 输入框确认
            playerNameInput.addEventListener('keypress', function(e) {
                if (e.key === 'Enter') {
                    const newName = playerNameInput.value.trim();
                    if (newName && newName !== '') {
                        gameState.playerName = newName;
                        playerNameElement.textContent = newName;
                        // 保存到本地存储
                        localStorage.setItem('lastPlayerName', newName);
                        showTooltip(`欢迎，${newName}！`);
                    }
                }
            });
            
            // 随机按钮点击事件
            randomNameBtn.addEventListener('click', selectRandomName);
        }
        
        // 保存历史记录
        function saveHistoryState(state) {
            if (state && state.history) {
                gameState.history = state.history;
            }
        }
        
        // 不再需要检查是否需要强制设置新姓名
        
        // 开始游戏
        startGameBtn.addEventListener('click', async () => {
            // 检查是否设置了姓名
            if (gameState.playerName === '？？？') {
                showTooltip('请先设置您的姓名');
                return;
            }
            
            try {
                const response = await fetch('/api/start_game', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ playerName: gameState.playerName })
                });
                
                const data = await response.json();
                gameState = data.current_state;
                
                // 全面修复：确保保留用户设置的玩家名称，处理各种边缘情况
                const savedPlayerName = localStorage.getItem('lastPlayerName');
                const previousPlayerName = gameState.playerName;
                
                // 情况1：如果本地存储有有效名称，优先使用
                if (savedPlayerName && savedPlayerName !== '？？？' && savedPlayerName !== 'undefined') {
                    gameState.playerName = savedPlayerName;
                }
                // 情况2：如果本地存储为空，但之前有有效名称，恢复之前的名称
                else if (previousPlayerName && previousPlayerName !== '？？？' && previousPlayerName !== 'undefined') {
                    gameState.playerName = previousPlayerName;
                }

                
                // 同步更新UI显示
                playerNameElement.textContent = gameState.playerName;
                saveHistoryState(data.current_state);
                updateGameStatus();
                
                // 标记游戏已开始，未完成
                localStorage.setItem('lastGameCompleted', 'false');
                
                // 显示会议信息
                document.getElementById('meeting-title').textContent = `第${data.meeting_count}次会议：董事会`;
                document.getElementById('meeting-description').textContent = data.description;
                document.getElementById('meeting-dilemma').innerHTML = `<span class="font-bold">当前困境：</span>${data.dilemma}`;
                document.getElementById('option-a-text').textContent = data.optionA;
                document.getElementById('option-b-text').textContent = data.optionB;
                
                // 切换界面
                startScreen.classList.add('hidden');
                meetingScreen.classList.remove('hidden');
                
            } catch (error) {
                console.error('开始游戏失败:', error);
                alert('游戏启动失败，请刷新页面重试');
            }
        });
        
        // 处理决策选择
        async function handleDecision(option) {
            // 播放梭哈语音音效
            playAllInSound();
            
            // 获取按钮位置并创建金币飞溅效果
            const button = option === 'A' ? optionA : optionB;
            const rect = button.getBoundingClientRect();
            const x = rect.left + rect.width / 2;
            const y = rect.top + rect.height / 2;
            createCoinParticles(x, y);
            
            try {
                const response = await fetch('/api/make_decision', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ option: option })
                });
                
                const data = await response.json();
                gameState = data.current_state;
                saveHistoryState(data.current_state);
                
                // 更新反馈信息
                document.getElementById('feedback-text').textContent = data.feedback;
                
                // 格式化变化值显示
                function formatChange(value) {
                    const sign = value > 0 ? '+' : '';
                    return `${sign}${value}`;
                }
                
                document.getElementById('money-change').textContent = formatChange(data.money_change);
                document.getElementById('morale-change').textContent = formatChange(data.morale_change);
                document.getElementById('market-change').textContent = formatChange(data.market_prospect_change);
                
                // 切换界面
                meetingScreen.classList.add('hidden');
                feedbackScreen.classList.remove('hidden');
                
                // 延迟更新状态条，显示动画效果
                setTimeout(() => {
                    updateGameStatus();
                }, 300);
                
                // 检查游戏是否结束
                if (gameState.game_over) {
                    // 准备结局界面
                    continueBtn.addEventListener('click', () => {
                        showEnding(data.ending_text);
                    }, { once: true });
                } else {
                    // 准备下一次会议
                    continueBtn.addEventListener('click', () => {
                        feedbackScreen.classList.add('hidden');
                        meetingScreen.classList.remove('hidden');
                        
                        const nextMeeting = data.next_meeting;
                        document.getElementById('meeting-title').textContent = `第${nextMeeting.meeting_count}次会议：董事会`;
                        document.getElementById('meeting-description').textContent = nextMeeting.description;
                        document.getElementById('meeting-dilemma').innerHTML = `<span class="font-bold">当前困境：</span>${nextMeeting.dilemma}`;
                        document.getElementById('option-a-text').textContent = nextMeeting.optionA;
                        document.getElementById('option-b-text').textContent = nextMeeting.optionB;
                    }, { once: true });
                }
                
            } catch (error) {
                console.error('处理决策失败:', error);
                alert('处理决策失败，请刷新页面重试');
            }
        }
        
        // 计算成绩单
        function calculateReportCard() {
            if (!gameState.history || gameState.history.length === 0) return null;
            
            // 统计数据
            let totalDecisions = gameState.history.length - 1; // 减去初始状态
            let avgMoney = gameState.money;
            let avgMorale = gameState.morale;
            let avgMarketProspect = gameState.market_prospect;
            
            // 计算关键指标分数
            let finalScore = (avgMoney + avgMorale + avgMarketProspect) / 15;
            
            // 根据分数评定等级
            let grade = '';
            if (finalScore >= 95) grade = 'S';
            else if (finalScore >= 85) grade = 'A';
            else if (finalScore >= 70) grade = 'B';
            else if (finalScore >= 50) grade = 'C';
            else if (finalScore >= 30) grade = 'D';
            else grade = 'F';
            
            return {
                totalDecisions: totalDecisions,
                finalScore: Math.round(finalScore),
                grade: grade,
                moneyScore: avgMoney,
                moraleScore: avgMorale,
                marketScore: avgMarketProspect
            };
        }
        
        // 渲染历史记录图表
        function renderHistoryChart() {
            // 确保有历史数据和图表元素
            if (!gameState.history || gameState.history.length === 0) return;
            
            const chartElement = document.getElementById('history-chart');
            if (!chartElement) return;
            
            // 准备数据
            const labels = gameState.history.map((item, index) => 
                index === 0 ? '初始' : `决策${index}`
            );
            const moneyData = gameState.history.map(item => item.money);
            const moraleData = gameState.history.map(item => item.morale);
            const marketData = gameState.history.map(item => item.market_prospect);
            
            // 动态计算纵轴最大值，取所有数据中的最大值并向上取整到合适的值
            const allData = [...moneyData, ...moraleData, ...marketData];
            const maxValue = Math.max(...allData);
            // 向上取整，确保有足够的空间显示数据
            const yMax = Math.ceil(maxValue * 1.1); // 增加10%的缓冲空间
            
            // 如果图表已存在，销毁它
            if (window.historyChart) {
                window.historyChart.destroy();
            }
            
            // 获取画布上下文
            const ctx = chartElement.getContext('2d');
            
            // 创建简化的图表
            window.historyChart = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: labels,
                    datasets: [
                        {
                            label: '资金',
                            data: moneyData,
                            borderColor: '#f59e0b',
                            backgroundColor: 'rgba(245, 158, 11, 0.1)',
                            tension: 0.3,
                            fill: true
                        },
                        {
                            label: '士气',
                            data: moraleData,
                            borderColor: '#10b981',
                            backgroundColor: 'rgba(16, 185, 129, 0.1)',
                            tension: 0.3,
                            fill: true
                        },
                        {
                            label: '公司前景',
                            data: marketData,
                            borderColor: '#2563eb',
                            backgroundColor: 'rgba(37, 99, 235, 0.1)',
                            tension: 0.3,
                            fill: true
                        }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'top',
                            labels: {
                                color: '#e5e7eb'
                            }
                        },
                        title: {
                            display: true,
                            text: '公司发展趋势图',
                            color: '#f3f4f6'
                        }
                    },
                    scales: {
                        x: {
                            grid: {
                                color: 'rgba(255, 255, 255, 0.1)'
                            },
                            ticks: {
                                color: '#9ca3af'
                            }
                        },
                        y: {
                            min: 0,
                            max: yMax,
                            grid: {
                                color: 'rgba(255, 255, 255, 0.1)'
                            },
                            ticks: {
                                color: '#9ca3af'
                            }
                        }
                    }
                }
            });
        }
        
        // 渲染历史记录时间线
        function renderHistoryTimeline() {
            if (!gameState.history || gameState.history.length === 0) return;
            
            const timelineContainer = document.getElementById('history-timeline');
            timelineContainer.innerHTML = '';
            
            gameState.history.forEach((event, index) => {
                // 跳过初始状态
                if (index === 0) {
                    const initialEvent = document.createElement('div');
                    initialEvent.className = 'flex mb-8 relative animate-fade-in';
                    initialEvent.innerHTML = `
                        <div class="flex flex-col items-center mr-6">
                            <div class="h-14 w-14 rounded-full bg-gradient-to-br from-primary to-secondary flex items-center justify-center text-white z-10 shadow-lg">
                                <i class="fa fa-building text-xl"></i>
                            </div>
                            ${index < gameState.history.length - 1 ? '<div class="h-full w-0.5 bg-gray-700 absolute top-14 bottom-0 left-7"></div>' : ''}
                        </div>
                        <div class="bg-gray-800 p-6 rounded-xl shadow-lg flex-1 border-l-4 border-primary card-hover">
                            <h4 class="font-bold text-primary text-xl mb-3">${event.event}</h4>
                            <p class="text-gray-300 mb-4">${event.decision || '公司创立初期'}</p>
                            <div class="grid grid-cols-3 gap-4 text-sm">
                                <div class="bg-gray-900 rounded-lg p-3 border-l-2 border-warning">
                                    <div class="text-xs text-gray-400 mb-1">资金储备</div>
                                    <span class="font-bold text-warning">${event.money}/1000</span>
                                </div>
                                <div class="bg-gray-900 rounded-lg p-3 border-l-2 border-success">
                                    <div class="text-xs text-gray-400 mb-1">团队士气</div>
                                    <span class="font-bold text-success">${event.morale}/1000</span>
                                </div>
                                <div class="bg-gray-900 rounded-lg p-3 border-l-2 border-primary">
                                    <div class="text-xs text-gray-400 mb-1">公司前景</div>
                                    <span class="font-bold text-primary">${event.market_prospect}/1000</span>
                                </div>
                            </div>
                        </div>
                    `;
                    timelineContainer.appendChild(initialEvent);
                    return;
                }
                
                const timelineItem = document.createElement('div');
                timelineItem.className = 'flex mb-8 relative animate-fade-in';
                
                // 格式化变化值的显示
                function formatChange(value) {
                    const sign = value > 0 ? '+' : '';
                    return `<span class="${value > 0 ? 'text-green-500 font-bold' : value < 0 ? 'text-red-500 font-bold' : 'text-gray-400'}">${sign}${value}</span>`;
                }
                
                timelineItem.innerHTML = `
                    <div class="flex flex-col items-center mr-6">
                        <div class="h-14 w-14 rounded-full bg-gradient-to-br from-secondary to-primary flex items-center justify-center text-white z-10 shadow-lg">
                                <i class="fa fa-line-chart text-xl"></i>
                            </div>
                        ${index < gameState.history.length - 1 ? '<div class="h-full w-0.5 bg-gray-700 absolute top-14 bottom-0 left-7"></div>' : ''}
                    </div>
                    <div class="bg-gray-800 p-6 rounded-xl shadow-lg flex-1 border-l-4 border-secondary card-hover">
                        <h4 class="font-bold text-secondary text-xl mb-3">第${index}次决策: ${event.event}</h4>
                        <p class="text-gray-300 mb-3">${event.decision}</p>
                        <p class="text-gray-400 text-sm mb-4 italic">${event.feedback}</p>
                        <div class="grid grid-cols-3 gap-4 text-sm">
                            <div class="bg-gray-900 rounded-lg p-3 border-l-2 border-warning">
                                <div class="text-xs text-gray-400 mb-1">资金储备</div>
                                <div class="font-bold text-warning">${event.money}/1000</div>
                                <div class="text-xs mt-1">${formatChange(event.money_change)}</div>
                            </div>
                            <div class="bg-gray-900 rounded-lg p-3 border-l-2 border-success">
                                <div class="text-xs text-gray-400 mb-1">团队士气</div>
                                <div class="font-bold text-success">${event.morale}/1000</div>
                                <div class="text-xs mt-1">${formatChange(event.morale_change)}</div>
                            </div>
                            <div class="bg-gray-900 rounded-lg p-3 border-l-2 border-primary">
                                <div class="text-xs text-gray-400 mb-1">公司前景</div>
                                <div class="font-bold text-primary">${event.market_prospect}/1000</div>
                                <div class="text-xs mt-1">${formatChange(event.market_prospect_change)}</div>
                            </div>
                        </div>
                    </div>
                `;
                
                timelineContainer.appendChild(timelineItem);
            });
        }
        
        // 切换标签页
        function switchTab(tabName) {
            // 隐藏所有内容
            document.getElementById('report-card-content').classList.add('hidden');
            document.getElementById('history-content').classList.add('hidden');
            document.getElementById('leaderboard-content').classList.add('hidden');
            
            // 重置所有标签样式
            const tabs = ['report-card-tab', 'history-tab', 'leaderboard-tab'];
            tabs.forEach(tabId => {
                document.getElementById(tabId).classList.remove('bg-gradient-to-r', 'from-primary', 'to-secondary', 'text-white');
                document.getElementById(tabId).classList.add('bg-gray-800', 'text-gray-300');
            });
            
            // 显示选中的内容和样式
            document.getElementById(`${tabName}-content`).classList.remove('hidden');
            document.getElementById(`${tabName}-tab`).classList.remove('bg-gray-800', 'text-gray-300');
            document.getElementById(`${tabName}-tab`).classList.add('bg-gradient-to-r', 'from-primary', 'to-secondary', 'text-white');
            
            // 根据标签类型渲染对应内容
            if (tabName === 'leaderboard') {
                renderLeaderboard();
            }
            
            // 根据标签类型渲染对应内容
            if (tabName === 'history') {
                renderHistoryTimeline();
                // 在历史记录页面添加统一的玩家信息展示
                setTimeout(() => {
                    const reportCard = calculateReportCard();
                    let historyPlayerInfo = document.getElementById('history-player-info');
                    if (!historyPlayerInfo) {
                        historyPlayerInfo = document.createElement('div');
                        historyPlayerInfo.id = 'history-player-info';
                        historyPlayerInfo.className = 'mb-6';
                        const historyTimeline = document.getElementById('history-timeline');
                        if (historyTimeline && historyTimeline.firstChild) {
                            historyTimeline.insertBefore(historyPlayerInfo, historyTimeline.firstChild);
                        }
                    }
                    renderPlayerInfo(historyPlayerInfo, gameState.playerName, reportCard?.finalScore, reportCard?.grade);
                }, 100);
            } else if (tabName === 'report-card') {
                renderHistoryChart();
                // 在成绩单页面添加统一的玩家信息展示
                setTimeout(() => {
                    const reportCard = calculateReportCard();
                    let transcriptPlayerInfo = document.getElementById('transcript-player-info');
                    if (!transcriptPlayerInfo) {
                        transcriptPlayerInfo = document.createElement('div');
                        transcriptPlayerInfo.id = 'transcript-player-info';
                        transcriptPlayerInfo.className = 'mb-6';
                        const reportCardContent = document.getElementById('report-card-content');
                        if (reportCardContent && reportCardContent.firstChild) {
                            reportCardContent.insertBefore(transcriptPlayerInfo, reportCardContent.firstChild);
                        }
                    }
                    renderPlayerInfo(transcriptPlayerInfo, gameState.playerName, reportCard?.finalScore, reportCard?.grade);
                }, 100);
            }
        }
        
        // 创建庆祝撒花效果
        function createCelebrationConfetti() {
            // 检查是否已存在庆祝元素
            const existingConfetti = document.getElementById('celebration-confetti');
            if (existingConfetti) {
                existingConfetti.remove();
            }
            
            const confettiContainer = document.createElement('div');
            confettiContainer.id = 'celebration-confetti';
            confettiContainer.className = 'fixed inset-0 pointer-events-none z-50';
            
            // 创建50个彩色碎片
            for (let i = 0; i < 50; i++) {
                const confetti = document.createElement('div');
                
                // 随机颜色
                const colors = ['#FFD700', '#FF6B6B', '#4ECDC4', '#45B7D1', '#FFA500', '#FF69B4'];
                const color = colors[Math.floor(Math.random() * colors.length)];
                
                // 随机大小和形状
                const size = Math.random() * 10 + 5;
                const shapes = ['circle', 'square', 'triangle'];
                const shape = shapes[Math.floor(Math.random() * shapes.length)];
                
                // 设置样式
                confetti.style.position = 'absolute';
                confetti.style.backgroundColor = color;
                confetti.style.width = `${size}px`;
                confetti.style.height = `${size}px`;
                confetti.style.left = `${Math.random() * 100}%`;
                confetti.style.top = '-20px';
                confetti.style.borderRadius = shape === 'circle' ? '50%' : shape === 'square' ? '0' : '0';
                
                // 为三角形设置特殊样式
                if (shape === 'triangle') {
                    confetti.style.width = '0';
                    confetti.style.height = '0';
                    confetti.style.borderLeft = `${size/2}px solid transparent`;
                    confetti.style.borderRight = `${size/2}px solid transparent`;
                    confetti.style.borderBottom = `${size}px solid ${color}`;
                    confetti.style.backgroundColor = 'transparent';
                }
                
                // 设置随机动画
                const duration = Math.random() * 3 + 2;
                const delay = Math.random() * 2;
                const xOffset = Math.random() * 100 - 50;
                
                confetti.style.animation = `confetti-fall ${duration}s linear ${delay}s forwards`;
                confetti.style.setProperty('--x-offset', `${xOffset}px`);
                
                confettiContainer.appendChild(confetti);
            }
            
            document.body.appendChild(confettiContainer);
        }
        
        // 显示结局
        function showEnding(endingText) {
            feedbackScreen.classList.add('hidden');
            endingScreen.classList.remove('hidden');
            
            // 保存游戏记录
            saveGameRecord();
            
            // 根据结局类型设置标题和样式
            let endingTitle = '';
            let titleIcon = '';
            let titleColorClass = '';
            
            // 检查是否为上市结局或成功结局
            const isSuccessfulEnding = endingText.includes('获得现金退出') || endingText.includes('公司成功上市') ;
            
            if (isSuccessfulEnding) {
                endingTitle = '恭喜成功！';
                titleIcon = 'fa-trophy';
                titleColorClass = 'bg-gradient-to-r from-green-400 to-emerald-500';
                
                // 为上市结局添加庆祝撒花效果
                createCelebrationConfetti();
            } else if (endingText.includes('宣布破产')|| endingText.includes('士气崩溃') || endingText.includes('关闭业务') ) {
                endingTitle = '公司破产';
                titleIcon = 'fa-exclamation-circle';
                titleColorClass = 'bg-gradient-to-r from-red-400 to-rose-500';
            } else {
                endingTitle = '平淡是真';
                titleIcon = 'fa-chart-line';
                titleColorClass = 'bg-gradient-to-r from-primary to-secondary';
            }
            
            // 更新进度条样式 - 移到外部确保全局可访问
            const updateProgressBar = (elementId, value) => {
                const bar = document.getElementById(elementId);
                if (bar) { // 添加null检查
                    bar.style.width = `${value}%`;
                }
            };
            
            // 美化标题显示
            const endingTitleElement = document.getElementById('ending-title');
            if (endingTitleElement) {
                endingTitleElement.innerHTML = `
                    <i class="fa ${titleIcon} mr-3"></i>
                    <span class="bg-clip-text text-transparent ${titleColorClass}">${endingTitle}</span>
                `;
            }
            
            const endingTextElement = document.getElementById('ending-text');
            if (endingTextElement) {
                endingTextElement.textContent = endingText;
            }
            
            // 计算并显示成绩单
            const reportCard = calculateReportCard();
            if (reportCard) {
                // 在结局界面显示统一的玩家信息
                let playerNameHeader = document.getElementById('player-name-header');
                if (!playerNameHeader) {
                    playerNameHeader = document.createElement('div');
                    playerNameHeader.id = 'player-name-header';
                    playerNameHeader.className = 'mb-8';
                    const endingContent = document.querySelector('#ending-screen .ending-content');
                    if (endingContent && endingContent.firstChild) {
                        endingContent.insertBefore(playerNameHeader, endingContent.firstChild);
                    }
                }
                
                // 添加严格的防御性检查，确保玩家名称安全显示
                const safePlayerName = gameState.playerName && gameState.playerName !== 'undefined' && gameState.playerName !== '？？？' 
                    ? gameState.playerName 
                    : (localStorage.getItem('lastPlayerName') || '未知玩家');
                
                // 记录ending界面的playerName使用情况
                logger.playerName('Ending Display', safePlayerName, 
                    gameState.playerName ? 
                    (gameState.playerName === safePlayerName ? 'GameState' : 'Fallback from ' + gameState.playerName) : 
                    'No GameState playerName');
                    
                renderPlayerInfo(playerNameHeader, safePlayerName, reportCard.finalScore, reportCard.grade);
                
                // 更新成绩单数据
                const totalDecisionsEl = document.getElementById('total-decisions');
                const finalScoreEl = document.getElementById('final-score');
                const finalGradeEl = document.getElementById('final-grade');
                const moneyScoreEl = document.getElementById('money-score');
                const moraleScoreEl = document.getElementById('morale-score');
                const marketScoreEl = document.getElementById('market-score');
                
                if (totalDecisionsEl) totalDecisionsEl.textContent = reportCard.totalDecisions;
                if (finalScoreEl) finalScoreEl.textContent = reportCard.finalScore;
                if (finalGradeEl) {
                    finalGradeEl.textContent = reportCard.grade;
                    finalGradeEl.className = 'text-5xl font-bold flex items-center';
                    let gradeIcon = '';
                    
                    if (reportCard.grade === 'S') {
                        finalGradeEl.classList.add('text-amber-500');
                        gradeIcon = 'fa-crown';
                    } else if (reportCard.grade === 'A') {
                        finalGradeEl.classList.add('text-green-500');
                        gradeIcon = 'fa-star';
                    } else if (reportCard.grade === 'B') {
                        finalGradeEl.classList.add('text-blue-500');
                        gradeIcon = 'fa-thumbs-up';
                    } else if (reportCard.grade === 'C') {
                        finalGradeEl.classList.add('text-purple-500');
                        gradeIcon = 'fa-balance-scale';
                    } else if (reportCard.grade === 'D') {
                        finalGradeEl.classList.add('text-orange-500');
                        gradeIcon = 'fa-exclamation-triangle';
                    } else {
                        finalGradeEl.classList.add('text-red-500');
                        gradeIcon = 'fa-bolt';
                    }
                    
                    // 添加图标
                    finalGradeEl.innerHTML = `
                        <i class="fa ${gradeIcon} mr-2 animate-pulse"></i>
                        ${reportCard.grade}
                    `;
                }
                
                if (moneyScoreEl) moneyScoreEl.textContent = reportCard.moneyScore;
                if (moraleScoreEl) moraleScoreEl.textContent = reportCard.moraleScore;
                if (marketScoreEl) marketScoreEl.textContent = reportCard.marketScore;
                
                // 更新进度条
                updateProgressBar('money-progress', reportCard.moneyScore);
                updateProgressBar('morale-progress', reportCard.moraleScore);
                updateProgressBar('market-progress', reportCard.marketScore);
            }
            
            // 渲染历史记录图表
            renderHistoryChart();
            
            // 默认显示成绩单标签
                switchTab('report-card');
                
                // 在成绩单页面添加统一的玩家信息展示
                setTimeout(() => {
                    let transcriptPlayerInfo = document.getElementById('transcript-player-info');
                    if (!transcriptPlayerInfo) {
                        transcriptPlayerInfo = document.createElement('div');
                        transcriptPlayerInfo.id = 'transcript-player-info';
                        transcriptPlayerInfo.className = 'mb-6';
                        const reportCardContent = document.getElementById('report-card-content');
                        if (reportCardContent && reportCardContent.firstChild) {
                            reportCardContent.insertBefore(transcriptPlayerInfo, reportCardContent.firstChild);
                        }
                    }
                    renderPlayerInfo(transcriptPlayerInfo, gameState.playerName, reportCard.finalScore, reportCard.grade);
                }, 100);
            }
        
        // 重新开始游戏
        restartBtn.addEventListener('click', () => {
            // 重置游戏状态 - 确保playerName安全重置
            gameState = {
                money: 100,
                morale: 60,
                market_prospect: 40,
                story_stage: 1.0,
                game_over: false,
                game_over_saved: false, // 重置保存标志
                history: [],
                playerName: '？？？' // 初始化为占位符，但后续会在开始游戏时更新为真实名称
            };
            // 立即保存到本地存储，确保一致状态
            localStorage.setItem('lastPlayerName', gameState.playerName);
            
            // 重置姓名显示
            playerNameElement.textContent = '？？？';
            playerNameInput.value = '';
            // 移除最后一次玩家姓名的存储，强制重新设置
            localStorage.removeItem('lastPlayerName');
            
            updateGameStatus();
            
            // 清除样式类
            document.getElementById('ending-title').className = 'text-3xl font-bold mb-6';
            
            // 销毁图表
            if (window.historyChart) {
                window.historyChart.destroy();
                window.historyChart = null;
            }
            
            // 切换到开始界面
            endingScreen.classList.add('hidden');
            startScreen.classList.remove('hidden');
            
            // 显示历史记录排行榜
            loadAndDisplayLeaderboard();
        });
        
        // 统一的玩家信息展示函数
        function renderPlayerInfo(element, playerName, score = null, level = null) {
            // 最严格的防御性检查，确保playerName永远不会显示为undefined
            const safePlayerName = 
                playerName !== undefined && 
                playerName !== null && 
                playerName !== 'undefined' && 
                playerName !== '？？？' && 
                playerName.trim() !== ''
                    ? playerName 
                    : (localStorage.getItem('lastPlayerName') || '未知玩家');
            
            const playerInfoHtml = `
                <div class="player-info-display text-center">
                    <div class="text-xl font-semibold text-gray-300 mb-1">玩家信息</div>
                    <div class="text-2xl font-bold">
                        <span>霸总</span>
                        <span class="font-bold text-[120%] text-gradient cursor-pointer hover:underline">${safePlayerName}</span>
                        <span>的商业帝国</span>
                    </div>
                    ${score !== null ? `<div class="mt-2 text-lg">最终得分：<span class="font-bold text-yellow-400">${score}</span></div>` : ''}
                    ${level !== null ? `<div class="mt-1 text-lg">达成等级：<span class="font-bold text-green-400">${level}</span></div>` : ''}
                </div>
            `;
            
            // 记录renderPlayerInfo的调用信息
            logger.playerName('Rendering', safePlayerName, 
                playerName === safePlayerName ? 'Original' : 
                playerName === undefined ? 'Undefined Fallback' : 
                playerName === null ? 'Null Fallback' : 
                playerName === 'undefined' ? 'String Undefined Fallback' : 
                playerName === '？？？' ? 'Placeholder Fallback' : 
                'Empty String Fallback');
            
            if (typeof element === 'string') {
                const el = document.getElementById(element);
                if (el) el.innerHTML = playerInfoHtml;
            } else if (element) {
                element.innerHTML = playerInfoHtml;
            }
        }
        
        // 游戏记录数据模型和存储管理模块
        class GameRecordManager {
            constructor() {
                this.storageKey = 'gameRecords';
                this.maxRecords = 10;
                this.listeners = [];
            }
            
            // 创建新记录 - 添加严格的防御性检查
            createRecord(reportCard, playerName) {
                if (!reportCard) return null;
                
                // 确保playerName永远不会是undefined或空字符串
                const safePlayerName = playerName && playerName !== 'undefined' && playerName !== '？？？' 
                    ? playerName 
                    : (localStorage.getItem('lastPlayerName') || '未知玩家');
                
                // 记录playerName变化
                logger.playerName('Record Creation', safePlayerName, playerName ? 'Provided' : 'Fallback');
                
                const record = {
                    playerName: safePlayerName,
                    finalScore: reportCard.finalScore,
                    achievementLevel: reportCard.grade,
                    timestamp: new Date().toISOString(),
                    gameId: Date.now().toString(), // 唯一ID
                    // 扩展字段，便于后续功能扩展
                    gameVersion: '1.0',
                    difficulty: gameState.difficulty || 'normal'
                };
                
                return record;
            }
            
            // 保存记录
            saveRecord(record) {
                if (!record) return false;
                
                try {
                    // 获取现有记录
                    const records = this.getAllRecords();
                    
                    // 添加新记录
                    records.push(record);
                    
                    // 按得分降序排序
                    records.sort((a, b) => b.finalScore - a.finalScore);
                    
                    // 限制记录数量
                    if (records.length > this.maxRecords) {
                        records.splice(this.maxRecords);
                    }
                    
                    // 保存到本地存储
                    localStorage.setItem(this.storageKey, JSON.stringify(records));
                    localStorage.setItem('lastGameCompleted', 'true');
                    
                    // 通知监听器
                    this.notifyListeners(records);
                    
                    return true;
                } catch (error) {
                    console.error('保存游戏记录失败:', error);
                    return false;
                }
            }
            
            // 获取所有记录
            getAllRecords() {
                try {
                    const records = JSON.parse(localStorage.getItem(this.storageKey)) || [];
                    // 确保数据格式正确
                    return records.filter(record => this.isValidRecord(record));
                } catch (error) {
                    console.error('读取游戏记录失败:', error);
                    return [];
                }
            }
            
            // 获取排行榜数据（按得分排序）
            getLeaderboardData(limit = this.maxRecords) {
                const records = this.getAllRecords();
                return records.sort((a, b) => b.finalScore - a.finalScore).slice(0, limit);
            }
            
            // 删除记录
            deleteRecord(gameId) {
                try {
                    const records = this.getAllRecords();
                    const filteredRecords = records.filter(record => record.gameId !== gameId);
                    localStorage.setItem(this.storageKey, JSON.stringify(filteredRecords));
                    this.notifyListeners(filteredRecords);
                    return true;
                } catch (error) {
                    console.error('删除游戏记录失败:', error);
                    return false;
                }
            }
            
            // 清空所有记录
            clearAllRecords() {
                try {
                    localStorage.removeItem(this.storageKey);
                    this.notifyListeners([]);
                    return true;
                } catch (error) {
                    console.error('清空游戏记录失败:', error);
                    return false;
                }
            }
            
            // 验证记录格式
            isValidRecord(record) {
                return record && 
                       typeof record.playerName === 'string' &&
                       typeof record.finalScore === 'number' &&
                       typeof record.achievementLevel === 'string' &&
                       typeof record.timestamp === 'string' &&
                       typeof record.gameId === 'string';
            }
            
            // 添加数据变更监听器
            addListener(callback) {
                if (typeof callback === 'function' && !this.listeners.includes(callback)) {
                    this.listeners.push(callback);
                }
            }
            
            // 移除监听器
            removeListener(callback) {
                this.listeners = this.listeners.filter(cb => cb !== callback);
            }
            
            // 通知所有监听器
            notifyListeners(records) {
                this.listeners.forEach(callback => {
                    try {
                        callback(records);
                    } catch (error) {
                        console.error('通知监听器失败:', error);
                    }
                });
            }
        }
        
        // 创建全局游戏记录管理器实例
        const gameRecordManager = new GameRecordManager();
        
        // 保存游戏记录（使用新的数据管理模块）
        function saveGameRecord() {
            // 防止重复保存：检查是否已经保存过
            if (gameState.game_over_saved) {
                logger.warn('游戏记录已保存，避免重复保存');
                return;
            }
            
            const reportCard = calculateReportCard();
            if (!reportCard) return;
            
            // 创建唯一标识用于去重
            const gameSessionId = Date.now() + '-' + Math.random().toString(36).substr(2, 9);
            
            // 创建记录并保存
            const newRecord = gameRecordManager.createRecord(reportCard, gameState.playerName);
            if (newRecord) {
                // 添加会话ID用于去重
                newRecord.sessionId = gameSessionId;
                gameRecordManager.saveRecord(newRecord);
                
                // 标记已保存
                gameState.game_over_saved = true;
                logger.info('游戏记录已成功保存，会话ID:', gameSessionId);
            }
        }
        
        // 防抖函数
                    function debounce(func, wait) {
                        let timeout;
                        return function executedFunction(...args) {
                            const later = () => {
                                clearTimeout(timeout);
                                func(...args);
                            };
                            clearTimeout(timeout);
                            timeout = setTimeout(later, wait);
                        };
                    }
                    
                    // 渲染排行榜
                    function renderLeaderboard() {
                        // 显示加载状态
                        document.getElementById('leaderboard-loading').classList.remove('hidden');
                        document.getElementById('leaderboard-table').classList.add('hidden');
                        document.getElementById('leaderboard-empty').classList.add('hidden');
                        
                        // 模拟异步加载
                        setTimeout(() => {
                            // 使用数据管理模块获取排行榜数据
                            const gameRecords = gameRecordManager.getLeaderboardData();
                            const leaderboardBody = document.getElementById('leaderboard-body');
                            
                            // 隐藏加载状态
                            document.getElementById('leaderboard-loading').classList.add('hidden');
                            
                            if (gameRecords.length === 0) {
                                // 显示空状态
                                document.getElementById('leaderboard-empty').classList.remove('hidden');
                                return;
                            }
                            
                            // 显示表格
                            document.getElementById('leaderboard-table').classList.remove('hidden');
                            
                            // 清空表格内容
                            leaderboardBody.innerHTML = '';
                            
                            // 创建文档片段以优化DOM操作
                            const fragment = document.createDocumentFragment();
                            
                            // 预计算所有需要的数据
                            const processedRecords = gameRecords.map((record, index) => {
                                const date = new Date(record.timestamp);
                                const formattedDate = date.toLocaleString('zh-CN', {
                                    year: 'numeric',
                                    month: '2-digit',
                                    day: '2-digit',
                                    hour: '2-digit',
                                    minute: '2-digit'
                                });
                                
                                // 获取等级样式
                                const getLevelClass = (level) => {
                                    const levelClasses = {
                                        'S': 'text-yellow-400',
                                        'A': 'text-orange-400',
                                        'B': 'text-green-400',
                                        'C': 'text-blue-400',
                                        'D': 'text-purple-400',
                                        'F': 'text-red-400'
                                    };
                                    return levelClasses[level] || 'text-gray-400';
                                };
                                
                                // 获取排名样式
                                const getRankClass = (rank) => {
                                    if (rank === 1) return 'text-yellow-400';
                                    if (rank === 2) return 'text-gray-300';
                                    if (rank === 3) return 'text-yellow-700';
                                    return 'text-gray-400';
                                };
                                
                                return {
                                    record,
                                    index,
                                    formattedDate,
                                    levelClass: getLevelClass(record.achievementLevel),
                                    rankClass: getRankClass(index + 1)
                                };
                            });
                            
                            // 使用requestAnimationFrame优化渲染性能
                            requestAnimationFrame(() => {
                                // 添加记录到文档片段
                                processedRecords.forEach(({ record, index, formattedDate, levelClass, rankClass }) => {
                                    const row = document.createElement('tr');
                                    row.className = 'border-b border-gray-800 hover:bg-gray-750 transition-colors';
                                    row.style.opacity = '0';
                                    row.style.transform = 'translateY(20px)';
                                    row.style.transition = 'all 0.3s ease-out';
                                    row.style.willChange = 'opacity, transform';
                    
                    // 已从processedRecords中解构获取formattedDate、levelClass和rankClass
                    
                    row.innerHTML = `
                        <td class="py-3 px-4">
                            <div class="flex items-center">
                                <span class="font-bold ${rankClass}">${index + 1}</span>
                                ${index < 3 ? `<i class="fa fa-crown ml-2 ${rankClass}"></i>` : ''}
                            </div>
                        </td>
                        <td class="py-3 px-4 font-medium">${record.playerName}</td>
                        <td class="py-3 px-4 text-secondary font-bold">${record.finalScore}</td>
                        <td class="py-3 px-4"><span class="font-bold ${levelClass}">${record.achievementLevel}</span></td>
                        <td class="py-3 px-4 text-gray-400 hidden md:table-cell">${formattedDate}</td>
                        <td class="md:hidden py-3 px-4 text-gray-400 text-sm">${formattedDate.split(' ')[0]}</td>
                    `;
                    
                    fragment.appendChild(row);
                    
                    // 添加动画效果（直接在requestAnimationFrame中处理）
                    setTimeout(() => {
                        requestAnimationFrame(() => {
                            row.style.opacity = '1';
                            row.style.transform = 'translateY(0)';
                        });
                    }, 50 * index);
                });
                
                // 将文档片段一次性添加到DOM中
                leaderboardBody.appendChild(fragment);
                });
                
                // 添加删除所有记录的按钮
                const clearRecordsBtn = document.createElement('button');
                clearRecordsBtn.className = 'mt-4 px-4 py-2 bg-danger hover:bg-danger-dark rounded-lg transition-colors';
                clearRecordsBtn.innerHTML = '<i class="fa fa-trash mr-2"></i>删除所有记录';
                
                // 实现删除所有记录的点击事件
                clearRecordsBtn.onclick = () => {
                    // 添加确认对话框，防止误操作
                    if (confirm('确定要删除所有排行榜记录吗？此操作不可恢复！')) {
                        try {
                            // 记录操作日志
                            console.log('正在执行删除所有记录操作...');
                            
                            // 调用GameRecordManager的clearAllRecords方法
                            const success = gameRecordManager.clearAllRecords();
                            
                            if (success) {
                                console.log('所有记录已成功删除');
                                // 重新加载排行榜（监听器会自动更新UI）
                                const leaderboardContent = document.getElementById('leaderboard-content');
                                leaderboardContent.scrollTop = 0;
                            } else {
                                console.error('删除记录失败');
                                alert('删除记录失败，请稍后重试');
                            }
                        } catch (error) {
                            console.error('执行删除操作时发生错误:', error);
                            alert('操作出错: ' + error.message);
                        }
                    }
                };
                
                // 确保按钮不会重复添加
                const existingBtn = document.getElementById('leaderboard-clear-all');
                if (existingBtn) {
                    existingBtn.remove();
                }
                clearRecordsBtn.id = 'leaderboard-clear-all';
                document.getElementById('leaderboard-content').appendChild(clearRecordsBtn);
                
            }, 300); // 短暂延迟以显示加载动画
        }
        
        // 添加数据变更监听器
        function setupDataChangeListeners() {
            // 当数据变更时，如果当前正在查看排行榜，自动更新
            gameRecordManager.addListener((records) => {
                const leaderboardContent = document.getElementById('leaderboard-content');
                if (leaderboardContent && !leaderboardContent.classList.contains('hidden')) {
                    renderLeaderboard();
                }
            });
        }
        
        // 初始化数据监听器
        setupDataChangeListeners();
        
        // 加载并显示排行榜
        function loadAndDisplayLeaderboard() {
            // 使用数据管理模块获取排行榜数据
            const sortedRecords = gameRecordManager.getLeaderboardData();
            
            // 创建排行榜界面
            createLeaderboardUI(sortedRecords);
        }
        
        // 添加响应式表格样式
                const addResponsiveStyles = () => {
                    const styleId = 'responsive-leaderboard-styles';
                    let styleElement = document.getElementById(styleId);
                    
                    if (!styleElement) {
                        styleElement = document.createElement('style');
                        styleElement.id = styleId;
                        document.head.appendChild(styleElement);
                    }
                    
                    styleElement.textContent = `
                        /* 标签页响应式布局 */
                        @media (max-width: 768px) {
                            .flex.flex-wrap.gap-4 {
                                justify-content: center;
                            }
                            .flex.flex-wrap.gap-4 button {
                                flex: 1;
                                min-width: 120px;
                            }
                        }
                        
                        @media (max-width: 480px) {
                            .flex.flex-wrap.gap-4 button {
                                min-width: 100px;
                                padding: 2px 4px;
                                font-size: 0.9rem;
                            }
                            .flex.flex-wrap.gap-4 button i {
                                display: block;
                                margin: 0 auto 2px;
                            }
                        }
                        
                        /* 排行榜表格响应式 */
                        @media (max-width: 768px) {
                            #leaderboard-table thead th:nth-child(5),
                            #leaderboard-table tbody td:nth-child(5) {
                                display: none;
                            }
                        }
                        
                        /* 优化表格性能 */
                        #leaderboard-table {
                            table-layout: fixed;
                            width: 100%;
                        }
                        
                        #leaderboard-table th:first-child,
                        #leaderboard-table td:first-child {
                            width: 80px;
                        }
                        
                        #leaderboard-table th:nth-child(3),
                        #leaderboard-table td:nth-child(3) {
                            width: 100px;
                        }
                        
                        #leaderboard-table th:nth-child(4),
                        #leaderboard-table td:nth-child(4) {
                            width: 80px;
                        }
                    `;
                };
                
                // 初始化响应式样式
                addResponsiveStyles();
                
                // 添加窗口大小变化的防抖处理
                const debouncedResizeHandler = debounce(() => {
                    const leaderboardContent = document.getElementById('leaderboard-content');
                    if (leaderboardContent && !leaderboardContent.classList.contains('hidden')) {
                        renderLeaderboard();
                    }
                    addResponsiveStyles();
                }, 300);
                
                window.addEventListener('resize', debouncedResizeHandler);
                
                // 清理函数（在组件卸载时调用）
                function cleanup() {
                    window.removeEventListener('resize', debouncedResizeHandler);
                }
                
                // 功能测试函数
                function testFeatureIntegrity() {
                    console.log('开始功能完整性测试...');
                    
                    // 测试1: 标签页导航系统
                    console.log('测试1: 标签页导航系统');
                    const reportCardTab = document.getElementById('report-card-tab');
                    const historyTab = document.getElementById('history-tab');
                    const leaderboardTab = document.getElementById('leaderboard-tab');
                    
                    const reportCardContent = document.getElementById('report-card-content');
                    const historyContent = document.getElementById('history-content');
                    const leaderboardContent = document.getElementById('leaderboard-content');
                    
                    let tabsTestPassed = false;
                    if (reportCardTab && historyTab && leaderboardTab && reportCardContent && historyContent && leaderboardContent) {
                        // 模拟点击排行榜标签
                        if (typeof switchTab === 'function') {
                            switchTab('leaderboard');
                            tabsTestPassed = !leaderboardContent.classList.contains('hidden') && 
                                            historyContent.classList.contains('hidden') && 
                                            reportCardContent.classList.contains('hidden');
                            console.log('- 标签页切换功能:', tabsTestPassed ? '✓ 通过' : '✗ 失败');
                        }
                    }
                    
                    // 测试2: 数据管理模块
                    console.log('测试2: 数据管理模块');
                    let dataModuleTestPassed = false;
                    if (typeof gameRecordManager === 'object') {
                        const testRecord = gameRecordManager.createRecord({
                            finalScore: 999,
                            achievementLevel: 'S',
                            decisions: []
                        }, '测试玩家');
                        
                        dataModuleTestPassed = gameRecordManager.isValidRecord(testRecord);
                        console.log('- 数据模型验证:', dataModuleTestPassed ? '✓ 通过' : '✗ 失败');
                    }
                    
                    // 测试3: 排行榜渲染
                    console.log('测试3: 排行榜渲染');
                    let leaderboardTestPassed = false;
                    if (typeof renderLeaderboard === 'function' && tabsTestPassed) {
                        // 先保存一些测试数据
                        if (typeof gameRecordManager === 'object') {
                            const mockRecords = [
                                { playerName: '测试玩家1', finalScore: 1000, achievementLevel: 'S', timestamp: new Date().toISOString(), gameId: 'test1' },
                                { playerName: '测试玩家2', finalScore: 900, achievementLevel: 'A', timestamp: new Date().toISOString(), gameId: 'test2' }
                            ];
                            
                            // 保存测试记录
                            mockRecords.forEach(record => {
                                gameRecordManager.saveRecord(record);
                            });
                            
                            // 重新渲染排行榜并检查结果
                            renderLeaderboard();
                            setTimeout(() => {
                                const rows = document.querySelectorAll('#leaderboard-body tr');
                                leaderboardTestPassed = rows.length >= 2;
                                console.log('- 排行榜渲染功能:', leaderboardTestPassed ? '✓ 通过' : '✗ 失败');
                            }, 400);
                        }
                    }
                    
                    // 测试4: 响应式设计检查
                    console.log('测试4: 响应式设计检查');
                    const responsiveStyleElement = document.getElementById('responsive-leaderboard-styles');
                    const responsiveTestPassed = responsiveStyleElement !== null;
                    console.log('- 响应式样式加载:', responsiveTestPassed ? '✓ 通过' : '✗ 失败');
                    
                    // 测试总结
                    setTimeout(() => {
                        console.log('\n===== 功能完整性测试总结 =====');
                        console.log('1. 标签页导航系统:', tabsTestPassed ? '✓ 通过' : '✗ 失败');
                        console.log('2. 数据管理模块:', dataModuleTestPassed ? '✓ 通过' : '✗ 失败');
                        console.log('3. 排行榜渲染:', leaderboardTestPassed ? '✓ 通过' : '✗ 失败');
                        console.log('4. 响应式设计:', responsiveTestPassed ? '✓ 通过' : '✗ 失败');
                        
                        const allTestsPassed = tabsTestPassed && dataModuleTestPassed && 
                                             leaderboardTestPassed && responsiveTestPassed;
                        console.log('\n总体测试结果:', allTestsPassed ? '✓ 全部通过' : '✗ 有测试未通过');
                    }, 500);
                }
                
                // 页面加载完成后执行测试（可选）
                // 取消下面的注释以在页面加载时自动运行测试
                // window.addEventListener('load', () => {
                //     setTimeout(testFeatureIntegrity, 1000);
                // });
        
        
        // 创建排行榜界面
        function createLeaderboardUI(records) {
            // 检查是否已存在排行榜元素
            let leaderboardSection = document.getElementById('leaderboard-section');
            if (!leaderboardSection) {
                // 创建排行榜区域
                leaderboardSection = document.createElement('div');
                leaderboardSection.id = 'leaderboard-section';
                leaderboardSection.className = 'bg-gray-900 rounded-xl p-6 mb-8 shadow-lg border border-gray-800';
                
                // 在开始界面添加排行榜
                const startScreen = document.getElementById('start-screen');
                const gameDescription = document.querySelector('#start-screen .game-description');
                if (startScreen && gameDescription) {
                    startScreen.insertBefore(leaderboardSection, gameDescription.nextSibling);
                }
            }
            
            // 构建排行榜内容
            const leaderboardHtml = `
                <h3 class="text-2xl font-bold mb-4 text-center bg-clip-text text-transparent bg-gradient-to-r from-primary to-secondary">
                    <i class="fa fa-trophy mr-2"></i>历史最佳记录
                </h3>
                ${records.length > 0 ? `
                    <div class="overflow-x-auto">
                        <table class="w-full text-left">
                            <thead>
                                <tr class="border-b border-gray-700">
                                    <th class="py-3 px-4 text-gray-400">排名</th>
                                    <th class="py-3 px-4 text-gray-400">玩家</th>
                                    <th class="py-3 px-4 text-gray-400">得分</th>
                                    <th class="py-3 px-4 text-gray-400">等级</th>
                                    <th class="py-3 px-4 text-gray-400">日期</th>
                                </tr>
                            </thead>
                            <tbody>
                                ${records.map((record, index) => {
                                    // 格式化日期
                                    const date = new Date(record.timestamp);
                                    const formattedDate = date.toLocaleString('zh-CN', {
                                        month: '2-digit',
                                        day: '2-digit',
                                        hour: '2-digit',
                                        minute: '2-digit'
                                    });
                                    
                                    // 获取等级图标和颜色
                                    let gradeIcon = '';
                                    let gradeColor = '';
                                    if (record.achievementLevel === 'S') {
                                        gradeIcon = 'fa-crown';
                                        gradeColor = 'text-amber-500';
                                    } else if (record.achievementLevel === 'A') {
                                        gradeIcon = 'fa-star';
                                        gradeColor = 'text-green-500';
                                    } else if (record.achievementLevel === 'B') {
                                        gradeIcon = 'fa-thumbs-up';
                                        gradeColor = 'text-blue-500';
                                    } else if (record.achievementLevel === 'C') {
                                        gradeIcon = 'fa-balance-scale';
                                        gradeColor = 'text-purple-500';
                                    } else if (record.achievementLevel === 'D') {
                                        gradeIcon = 'fa-exclamation-triangle';
                                        gradeColor = 'text-orange-500';
                                    } else {
                                        gradeIcon = 'fa-bolt';
                                        gradeColor = 'text-red-500';
                                    }
                                    
                                    // 前三名特殊样式
                                    let rowClass = '';
                                    let rankIcon = '';
                                    if (index === 0) {
                                        rowClass = 'bg-gray-800';
                                        rankIcon = '<i class="fa fa-medal text-amber-500 mr-2"></i>';
                                    } else if (index === 1) {
                                        rowClass = 'bg-gray-800/50';
                                        rankIcon = '<i class="fa fa-medal text-gray-300 mr-2"></i>';
                                    } else if (index === 2) {
                                        rowClass = 'bg-gray-800/30';
                                        rankIcon = '<i class="fa fa-medal text-amber-800 mr-2"></i>';
                                    }
                                    
                                    return `
                                        <tr class="${rowClass} border-b border-gray-800 hover:bg-gray-800/20 transition-colors">
                                            <td class="py-3 px-4">
                                                ${rankIcon}${index + 1}
                                            </td>
                                            <td class="py-3 px-4">
                                                <span class="font-bold">${record.playerName}</span>
                                            </td>
                                            <td class="py-3 px-4">
                                                <span class="font-bold text-yellow-400">${record.finalScore}</span>
                                            </td>
                                            <td class="py-3 px-4">
                                                <span class="flex items-center ${gradeColor} font-bold">
                                                    <i class="fa ${gradeIcon} mr-1"></i>${record.achievementLevel}
                                                </span>
                                            </td>
                                            <td class="py-3 px-4 text-gray-400">
                                                ${formattedDate}
                                            </td>
                                        </tr>
                                    `;
                                }).join('')}
                            </tbody>
                        </table>
                    </div>
                ` : `
                    <div class="text-center py-8 text-gray-400">
                        <i class="fa fa-trophy text-4xl mb-4 text-gray-700"></i>
                        <p>暂无历史记录</p>
                        <p class="text-sm mt-2">开始游戏，创造你的传奇！</p>
                    </div>
                `}
            `;
            
            leaderboardSection.innerHTML = leaderboardHtml;
        }
        
        // 页面加载时检查是否有历史记录并显示排行榜
        window.addEventListener('load', () => {
            loadAndDisplayLeaderboard();
        });
        
        // 标签切换事件
        document.getElementById('report-card-tab').addEventListener('click', () => switchTab('report-card'));
            document.getElementById('history-tab').addEventListener('click', () => switchTab('history'));
            document.getElementById('leaderboard-tab').addEventListener('click', () => switchTab('leaderboard'));
        
        // 选项点击事件
        optionA.addEventListener('click', () => handleDecision('A'));
        optionB.addEventListener('click', () => handleDecision('B'));
        
        // 添加淡出动画类
        const style = document.createElement('style');
        style.textContent = `
            @keyframes fadeOut {
                from { opacity: 1; }
                to { opacity: 0; }
            }
            .animate-fade-out {
                animation: fadeOut 0.3s ease-out;
            }
        `;
        document.head.appendChild(style);

        // 设置姓名输入事件
        setupNameInputEvents();
        
        // 全面的玩家名称功能测试函数 - 可在控制台调用以验证修复效果
        window.testPlayerNameFunctionality = function() {
            logger.info('开始全面玩家名称功能测试');
            console.log('========================================');
            console.log('📋 玩家名称功能测试开始');
            console.log('========================================');
            
            // 1. 检查当前游戏状态中的玩家名称
            console.log('\n🔍 测试1: 当前游戏状态检查');
            console.log('当前gameState.playerName:', gameState.playerName);
            console.log('当前localStorage.lastPlayerName:', localStorage.getItem('lastPlayerName'));
            
            // 2. 模拟不同玩家名称场景
            console.log('\n🔍 测试2: 模拟各种边缘情况');
            
            // 场景1: 正常名称
            const normalName = '测试玩家';
            const safeNormalName = normalName && normalName !== 'undefined' && normalName !== '？？？' ? normalName : (localStorage.getItem('lastPlayerName') || '未知玩家');
            console.log(`正常名称测试: 输入="${normalName}", 输出="${safeNormalName}"`, safeNormalName === normalName ? '✅ 通过' : '❌ 失败');
            
            // 场景2: undefined名称
            const undefinedName = undefined;
            const safeUndefinedName = undefinedName && undefinedName !== 'undefined' && undefinedName !== '？？？' ? undefinedName : (localStorage.getItem('lastPlayerName') || '未知玩家');
            console.log(`undefined名称测试: 输入="${undefinedName}", 输出="${safeUndefinedName}"`, safeUndefinedName !== undefined ? '✅ 通过' : '❌ 失败');
            
            // 场景3: 空字符串名称
            const emptyName = '';
            const safeEmptyName = emptyName && emptyName !== 'undefined' && emptyName !== '？？？' ? emptyName : (localStorage.getItem('lastPlayerName') || '未知玩家');
            console.log(`空字符串名称测试: 输入="${emptyName}", 输出="${safeEmptyName}"`, safeEmptyName !== '' ? '✅ 通过' : '❌ 失败');
            
            // 场景4: 'undefined'字符串名称
            const stringUndefinedName = 'undefined';
            const safeStringUndefinedName = stringUndefinedName && stringUndefinedName !== 'undefined' && stringUndefinedName !== '？？？' ? stringUndefinedName : (localStorage.getItem('lastPlayerName') || '未知玩家');
            console.log(`'undefined'字符串测试: 输入="${stringUndefinedName}", 输出="${safeStringUndefinedName}"`, safeStringUndefinedName !== 'undefined' ? '✅ 通过' : '❌ 失败');
            
            // 场景5: '？？？'占位符
            const placeholderName = '？？？';
            const safePlaceholderName = placeholderName && placeholderName !== 'undefined' && placeholderName !== '？？？' ? placeholderName : (localStorage.getItem('lastPlayerName') || '未知玩家');
            console.log(`占位符测试: 输入="${placeholderName}", 输出="${safePlaceholderName}"`, safePlaceholderName !== '？？？' || localStorage.getItem('lastPlayerName') === '？？？' ? '✅ 通过' : '❌ 失败');
            
            // 3. 验证修复点
            console.log('\n🔍 测试3: 关键修复点验证');
            
            // 测试GameRecordManager.createRecord方法的安全性
            try {
                // 保存当前状态
                const currentName = gameState.playerName;
                
                // 临时修改为undefined进行测试
                gameState.playerName = undefined;
                
                // 创建模拟reportCard
                const mockReportCard = { finalScore: 100, grade: 'S' };
                
                // 测试createRecord
                const record = gameRecordManager.createRecord(mockReportCard, gameState.playerName);
                console.log('GameRecordManager.createRecord安全测试:', record && record.playerName !== undefined ? '✅ 通过' : '❌ 失败');
                console.log('生成的记录playerName:', record ? record.playerName : '未生成记录');
                
                // 恢复状态
                gameState.playerName = currentName;
                logger.playerName('Test Restore', gameState.playerName, 'Test');
            } catch (e) {
                console.error('GameRecordManager.createRecord测试出错:', e);
                console.log('GameRecordManager.createRecord安全测试: ❌ 失败');
                logger.error('测试createRecord方法时出错', { error: e.message });
            }
            
            // 4. UI元素检查
            console.log('\n🔍 测试4: UI元素检查');
            const uiName = playerNameElement?.textContent || '未找到UI元素';
            console.log('UI中显示的玩家名称:', uiName);
            
            // 5. 验证三者一致性
            const localStorageName = localStorage.getItem('lastPlayerName');
            const isConsistent = localStorageName === gameState.playerName;
            console.log('名称一致性检查:', isConsistent ? '✅ 通过' : '❌ 未通过');
            
            console.log('\n========================================');
            console.log('📋 玩家名称功能测试完成');
            console.log('💡 提示: 如有问题，请查看控制台中的[PLAYER_NAME]和[ERROR]日志');
            console.log('========================================');
            
            logger.info('玩家名称功能测试完成');
            
            return { 
                localStorageName, 
                gameStateName: gameState.playerName, 
                uiName, 
                isConsistent, 
                hasValidName: gameState.playerName && gameState.playerName !== '？？？' && gameState.playerName !== 'undefined'
            };
        };
        
        // 自动运行测试并在控制台输出详细测试结果
        setTimeout(() => {
            if (typeof window !== 'undefined' && window.testPlayerNameFunctionality) {
                logger.info('自动运行玩家名称功能测试');
                console.log('======== 自动运行玩家名称功能测试 ========');
                const testResults = window.testPlayerNameFunctionality();
                
                // 显示详细的修复状态报告
                console.log('\n======== 修复状态报告 ========');
                console.log('- 游戏状态中玩家名称:', testResults.gameStateName);
                console.log('- 本地存储中玩家名称:', testResults.localStorageName);
                console.log('- UI显示中玩家名称:', testResults.uiName);
                console.log('- 名称一致性:', testResults.isConsistent ? '✅ 通过' : '❌ 未通过');
                console.log('- 名称有效性:', testResults.hasValidName ? '✅ 通过' : '❌ 未通过');
                
                // 最终状态总结
                if (testResults.hasValidName && testResults.gameStateName !== 'undefined') {
                    console.log('\n✅ 修复成功: 玩家名称不再显示为undefined');
                    logger.info('玩家名称修复验证成功');
                } else {
                    console.log('\n⚠️ 修复未完全成功: 请刷新页面或手动调用testPlayerNameFunctionality()查看详情');
                    logger.warn('玩家名称修复验证不完全成功');
                }
            }
        }, 1000);
        
        // 初始化状态显示
        updateGameStatus();
    </script>
</body>
</html>