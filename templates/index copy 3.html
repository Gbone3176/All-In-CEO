<!DOCTYPE html>
<html lang="zh-CN">
<head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>AI创业模拟 - CEO决策挑战</title>
        <script src="https://cdn.tailwindcss.com"></script>
        <link href="https://cdn.jsdelivr.net/npm/font-awesome@4.7.0/css/font-awesome.min.css" rel="stylesheet">
        <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: '#3b82f6', // 商务蓝色
                        secondary: '#8b5cf6', // 策略紫色
                        success: '#10b981', // 成功绿色
                        warning: '#f59e0b', // 财富金色
                        danger: '#ef4444', // 风险红色
                        neutral: '#0f172a', // 深色背景
                        'neutral-light': '#1e293b', // 卡片背景
                        'business-green': '#059669', // 商务绿色
                        'business-amber': '#d97706', // 商务琥珀色
                        'business-blue': '#2563eb', // 商务蓝色
                    },
                    fontFamily: {
                        sans: ['Inter', 'system-ui', 'sans-serif'],
                        business: ['Montserrat', 'sans-serif'],
                    },
                    backgroundImage: {
                        'business-pattern': "url('data:image/svg+xml,%3Csvg width='100' height='100' viewBox='0 0 100 100' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M11 18c3.866 0 7-3.134 7-7s-3.134-7-7-7-7 3.134-7 7 3.134 7 7 7zm48 25c3.866 0 7-3.134 7-7s-3.134-7-7-7-7 3.134-7 7 3.134 7 7 7zm-43-7c1.657 0 3-1.343 3-3s-1.343-3-3-3-3 1.343-3 3 1.343 3 3 3zm63 31c1.657 0 3-1.343 3-3s-1.343-3-3-3-3 1.343-3 3 1.343 3 3 3zM34 90c1.657 0 3-1.343 3-3s-1.343-3-3-3-3 1.343-3 3 1.343 3 3 3zm56-76c1.657 0 3-1.343 3-3s-1.343-3-3-3-3 1.343-3 3 1.343 3 3 3zM12 86c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm28-65c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm23-11c2.76 0 5-2.24 5-5s-2.24-5-5-5-5 2.24-5 5 2.24 5 5 5zm-6 60c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm29 22c2.76 0 5-2.24 5-5s-2.24-5-5-5-5 2.24-5 5 2.24 5 5 5zM32 63c2.76 0 5-2.24 5-5s-2.24-5-5-5-5 2.24-5 5 2.24 5 5 5zm57-13c2.76 0 5-2.24 5-5s-2.24-5-5-5-5 2.24-5 5 2.24 5 5 5zm-9-21c1.105 0 2-.895 2-2s-.895-2-2-2-2 .895-2 2 .895 2 2 2zM60 91c1.105 0 2-.895 2-2s-.895-2-2-2-2 .895-2 2 .895 2 2 2zM35 41c1.105 0 2-.895 2-2s-.895-2-2-2-2 .895-2 2 .895 2 2 2zM12 60c1.105 0 2-.895 2-2s-.895-2-2-2-2 .895-2 2 .895 2 2 2z' fill='%23ffffff' fill-opacity='0.05' fill-rule='evenodd'/%3E%3C/svg%3E')",
                    },
                }
            }
        };
        
        // 添加错误处理的正确方式
        try {
            // 图表创建代码可以放在这里
        } catch (error) {
            console.error('创建图表时出错:', error);
        }
        
    </script>
    <style type="text/tailwindcss">
        @layer utilities {
            .content-auto {
                content-visibility: auto;
            }
            .glass-effect {
                backdrop-filter: blur(12px);
                background-color: rgba(30, 41, 59, 0.8);
            }
            .card-shadow {
                box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.3), 0 4px 6px -2px rgba(0, 0, 0, 0.2);
            }
            .card-hover {
                transition: all 0.3s ease;
            }
            .card-hover:hover {
                transform: translateY(-5px);
                box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.2), 0 10px 10px -5px rgba(0, 0, 0, 0.1);
            }
            .animate-fade-in {
                animation: fadeIn 0.5s ease-in;
            }
            .animate-slide-up {
                animation: slideUp 0.5s ease-out;
            }
            .animate-pulse-slow {
                animation: pulse 3s cubic-bezier(0.4, 0, 0.6, 1) infinite;
            }
            .animate-shimmer {
                background: linear-gradient(90deg, rgba(255,255,255,0) 0%, rgba(255,255,255,0.1) 50%, rgba(255,255,255,0) 100%);
                background-size: 200% 100%;
                animation: shimmer 2s infinite;
            }
            .progress-bar {
                transition: width 0.5s ease-in-out;
            }
            .text-shadow {
                text-shadow: 0 2px 4px rgba(0, 0, 0, 0.3);
            }
            .border-gradient {
                position: relative;
                border-radius: 0.5rem;
            }
            .border-gradient::after {
                content: "";
                position: absolute;
                top: -2px;
                left: -2px;
                right: -2px;
                bottom: -2px;
                background: linear-gradient(45deg, #3b82f6, #8b5cf6, #ec4899, #3b82f6);
                background-size: 400%;
                border-radius: 0.6rem;
                z-index: -1;
                animation: borderAnimation 8s linear infinite;
            }
            .city-skyline-bg {
                position: fixed;
                bottom: 0;
                left: 0;
                right: 0;
                height: 200px;
                background: linear-gradient(to bottom, transparent, rgba(15, 23, 42, 0.95)),
                            url('data:image/svg+xml,%3Csvg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1440 200" fill="none"%3E%3Cpath d="M0,100 L50,120 L100,80 L150,130 L200,90 L250,110 L300,70 L350,140 L400,100 L450,120 L500,80 L550,130 L600,90 L650,110 L700,70 L750,140 L800,100 L850,120 L900,80 L950,130 L1000,90 L1050,110 L1100,70 L1150,140 L1200,100 L1250,120 L1300,80 L1350,130 L1400,90 L1440,100 V200 H0 V100 Z" fill="%231e293b" opacity="0.5"/%3E%3C/svg%3E');
                background-size: cover;
                background-repeat: no-repeat;
                z-index: -1;
                opacity: 0.8;
            }
            .rising-chart-decoration {
                position: absolute;
                opacity: 0.15;
                pointer-events: none;
                z-index: 0;
            }
            .arrow-up {
                display: inline-block;
                transform: rotate(45deg);
                width: 0;
                height: 0;
                border-style: solid;
                border-width: 0 8px 8px 0;
                border-color: transparent currentColor transparent transparent;
                margin-right: 4px;
            }
            .chart-point {
                width: 8px;
                height: 8px;
                border-radius: 50%;
                display: inline-block;
                margin-right: 5px;
                box-shadow: 0 0 10px currentColor;
            }
            .glow-effect {
                box-shadow: 0 0 20px rgba(59, 130, 246, 0.5);
            }
            .water-reflection {
                position: absolute;
                bottom: -200px;
                left: 0;
                right: 0;
                height: 200px;
                background: linear-gradient(to top, rgba(15, 23, 42, 0.7), transparent);
                transform: scaleY(-1);
                opacity: 0.2;
                pointer-events: none;
                z-index: -1;
            }
        }
        
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
        
        @keyframes slideUp {
            from { transform: translateY(20px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }
        
        @keyframes pulse {
            0%, 100% {
                opacity: 1;
            }
            50% {
                opacity: 0.7;
            }
        }
        
        @keyframes shimmer {
            0% {
                background-position: -200% 0;
            }
            100% {
                background-position: 200% 0;
            }
        }
        
        @keyframes borderAnimation {
            0% {
                background-position: 0 0;
            }
            100% {
                background-position: 400% 0;
            }
        }
    </style>
</head>
<body class="bg-gradient-to-br from-slate-900 to-slate-800 min-h-screen font-sans text-gray-100 overflow-x-hidden">
    <!-- 城市天际线背景 -->
    <div class="city-skyline-bg"></div>
    <div class="water-reflection"></div>
    
    <!-- 上升趋势图表装饰 -->
    <div class="rising-chart-decoration" style="top: 10%; left: 5%; width: 200px; height: 120px;">
        <svg viewBox="0 0 200 120" xmlns="http://www.w3.org/2000/svg">
            <polyline points="10,110 30,90 50,80 70,70 90,60 110,40 130,30 150,20 170,10 190,5" 
                      stroke="#3b82f6" stroke-width="2" fill="none" stroke-dasharray="5,3"/>
            <circle cx="10" cy="110" r="3" fill="#3b82f6"/>
            <circle cx="30" cy="90" r="3" fill="#3b82f6"/>
            <circle cx="50" cy="80" r="3" fill="#3b82f6"/>
            <circle cx="70" cy="70" r="3" fill="#3b82f6"/>
            <circle cx="90" cy="60" r="3" fill="#3b82f6"/>
            <circle cx="110" cy="40" r="3" fill="#3b82f6"/>
            <circle cx="130" cy="30" r="3" fill="#3b82f6"/>
            <circle cx="150" cy="20" r="3" fill="#3b82f6"/>
            <circle cx="170" cy="10" r="3" fill="#3b82f6"/>
            <circle cx="190" cy="5" r="3" fill="#3b82f6"/>
        </svg>
    </div>
    <div class="rising-chart-decoration" style="top: 30%; right: 5%; width: 150px; height: 100px; transform: rotate(10deg);">
        <svg viewBox="0 0 150 100" xmlns="http://www.w3.org/2000/svg">
            <polyline points="10,90 25,75 40,60 55,45 70,30 85,20 100,10 115,5 130,0" 
                      stroke="#8b5cf6" stroke-width="2" fill="none" stroke-dasharray="5,3"/>
            <circle cx="10" cy="90" r="3" fill="#8b5cf6"/>
            <circle cx="25" cy="75" r="3" fill="#8b5cf6"/>
            <circle cx="40" cy="60" r="3" fill="#8b5cf6"/>
            <circle cx="55" cy="45" r="3" fill="#8b5cf6"/>
            <circle cx="70" cy="30" r="3" fill="#8b5cf6"/>
            <circle cx="85" cy="20" r="3" fill="#8b5cf6"/>
            <circle cx="100" cy="10" r="3" fill="#8b5cf6"/>
            <circle cx="115" cy="5" r="3" fill="#8b5cf6"/>
            <circle cx="130" cy="0" r="3" fill="#8b5cf6"/>
        </svg>
    </div>
    <div class="container mx-auto px-4 py-8 max-w-5xl">
        <!-- 游戏标题 -->
        <header class="text-center mb-8 animate-fade-in relative">
            <div class="absolute -top-2 -right-2 w-16 h-16 bg-warning/20 rounded-full blur-xl"></div>
            <div class="absolute top-10 -left-4 w-12 h-12 bg-primary/20 rounded-full blur-lg"></div>
            
            <div class="inline-block mb-2 px-4 py-1 bg-gradient-to-r from-primary to-secondary rounded-full text-sm font-medium">
                CEO决策挑战 | 商业战略模拟
            </div>
            <h1 class="text-[clamp(2rem,5vw,3.5rem)] font-bold text-white mb-2 text-shadow relative z-10">
                <i class="fa fa-line-chart text-warning mr-2 animate-pulse-slow"></i>
                商业帝国崛起
            </h1>
            <p class="text-lg text-gray-300 max-w-3xl mx-auto font-light relative z-10">
                在这个高风险高回报的商业世界，每一个决策都可能改变公司命运。
                你能否在市场厮杀中脱颖而出，建立自己的商业帝国？
            </p>
        </header>
        
        <!-- 游戏状态面板 -->
        <div id="game-status" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4 mb-8 animate-slide-up">
            <!-- 公司控制权 -->
            <div class="bg-neutral-light rounded-xl p-5 card-shadow card-hover border-l-4 border-danger relative overflow-hidden">
                <div class="absolute top-0 right-0 w-24 h-24 bg-danger opacity-10 rounded-full transform translate-x-12 -translate-y-12"></div>
                <div class="flex justify-between items-center mb-3">
                    <h3 class="font-bold text-lg flex items-center text-white">
                        <i class="fa fa-shield text-danger mr-2"></i> 公司控制权
                    </h3>
                    <span id="control-value" class="text-xl font-bold text-danger">100%</span>
                </div>
                <div class="w-full bg-gray-700 rounded-full h-4 overflow-hidden">
                    <div id="control-bar" class="progress-bar bg-danger h-4 rounded-full animate-shimmer" style="width: 100%"></div>
                </div>
                <div class="text-xs text-gray-400 mt-1">
                    低于30%将失去公司控制权
                </div>
            </div>
            
            <!-- 经营健康度 -->
            <div class="bg-neutral-light rounded-xl p-5 card-shadow card-hover border-l-4 border-warning relative overflow-hidden">
                <div class="absolute top-0 right-0 w-24 h-24 bg-warning opacity-10 rounded-full transform translate-x-12 -translate-y-12"></div>
                <div class="flex justify-between items-center mb-3">
                    <h3 class="font-bold text-lg flex items-center text-white">
                        <i class="fa fa-heartbeat text-warning mr-2"></i> 经营健康度
                    </h3>
                    <span id="health-value" class="text-xl font-bold text-warning">80/100</span>
                </div>
                <div class="w-full bg-gray-700 rounded-full h-4 overflow-hidden">
                    <div id="health-bar" class="progress-bar bg-warning h-4 rounded-full animate-shimmer" style="width: 80%"></div>
                </div>
                <div class="text-xs text-gray-400 mt-1">
                    反映公司财务与运营状况
                </div>
            </div>
            
            <!-- 团队士气 -->
            <div class="bg-neutral-light rounded-xl p-5 card-shadow card-hover border-l-4 border-success relative overflow-hidden">
                <div class="absolute top-0 right-0 w-24 h-24 bg-success opacity-10 rounded-full transform translate-x-12 -translate-y-12"></div>
                <div class="flex justify-between items-center mb-3">
                    <h3 class="font-bold text-lg flex items-center text-white">
                        <i class="fa fa-users text-success mr-2"></i> 团队士气
                    </h3>
                    <span id="morale-value" class="text-xl font-bold text-success">85/100</span>
                </div>
                <div class="w-full bg-gray-700 rounded-full h-4 overflow-hidden">
                    <div id="morale-bar" class="progress-bar bg-success h-4 rounded-full animate-shimmer" style="width: 85%"></div>
                </div>
                <div class="text-xs text-gray-400 mt-1">
                    影响团队创造力与生产力
                </div>
            </div>
            
            <!-- 市场前景 -->
            <div class="bg-neutral-light rounded-xl p-5 card-shadow card-hover border-l-4 border-primary relative overflow-hidden">
                <div class="absolute top-0 right-0 w-24 h-24 bg-primary opacity-10 rounded-full transform translate-x-12 -translate-y-12"></div>
                <div class="flex justify-between items-center mb-3">
                    <h3 class="font-bold text-lg flex items-center text-white">
                        <i class="fa fa-line-chart text-primary mr-2"></i> 市场前景
                    </h3>
                    <span id="market-value" class="text-xl font-bold text-primary">90/100</span>
                </div>
                <div class="w-full bg-gray-700 rounded-full h-4 overflow-hidden">
                    <div id="market-bar" class="progress-bar bg-primary h-4 rounded-full animate-shimmer" style="width: 90%"></div>
                </div>
                <div class="text-xs text-gray-400 mt-1">
                    衡量市场竞争力与增长潜力
                </div>
            </div>
            
            <!-- 品牌影响力 -->
            <div class="bg-neutral-light rounded-xl p-5 card-shadow card-hover border-l-4 border-secondary relative overflow-hidden">
                <div class="absolute top-0 right-0 w-24 h-24 bg-secondary opacity-10 rounded-full transform translate-x-12 -translate-y-12"></div>
                <div class="flex justify-between items-center mb-3">
                    <h3 class="font-bold text-lg flex items-center text-white">
                        <i class="fa fa-bullhorn text-secondary mr-2"></i> 品牌影响力
                    </h3>
                    <span id="brand-value" class="text-xl font-bold text-secondary">70/100</span>
                </div>
                <div class="w-full bg-gray-700 rounded-full h-4 overflow-hidden">
                    <div id="brand-bar" class="progress-bar bg-secondary h-4 rounded-full animate-shimmer" style="width: 70%"></div>
                </div>
                <div class="text-xs text-gray-400 mt-1">
                    反映品牌认知度与美誉度
                </div>
            </div>
        </div>
        
        <!-- 剧情进度 -->
        <div class="bg-neutral-light rounded-xl p-5 mb-8 card-shadow animate-slide-up border-gradient">
            <div class="flex justify-between items-center mb-3">
                <h3 class="font-bold text-lg flex items-center text-white">
                    <i class="fa fa-trophy text-secondary mr-2"></i> 商业征程
                </h3>
                <span id="story-stage" class="text-xl font-bold text-secondary">初创阶段 (1.0/5)</span>
            </div>
            <div class="w-full bg-gray-700 rounded-full h-4 overflow-hidden">
                <div id="story-bar" class="progress-bar bg-gradient-to-r from-secondary to-primary h-4 rounded-full" style="width: 20%"></div>
            </div>
            <div class="flex justify-between text-xs text-gray-400 mt-2">
                <span>公司成立</span>
                <span>高速增长</span>
                <span>市场扩张</span>
                <span>行业领导者</span>
                <span>商业帝国</span>
            </div>
        </div>
        
        <!-- 游戏开始界面 -->
        <div id="start-screen" class="bg-neutral-light rounded-xl p-10 text-center card-shadow mb-8 animate-fade-in relative overflow-hidden border-gradient">
            <!-- 背景装饰 -->
            <div class="absolute inset-0 bg-business-pattern opacity-20"></div>
            <div class="absolute top-0 right-0 w-64 h-64 bg-primary opacity-5 rounded-full transform translate-x-32 -translate-y-32"></div>
            <div class="absolute bottom-0 left-0 w-64 h-64 bg-secondary opacity-5 rounded-full transform -translate-x-32 translate-y-32"></div>
            <!-- 城市天际线装饰 -->
            <div class="absolute bottom-0 left-0 right-0 h-32 opacity-10">
                <svg viewBox="0 0 1000 100" xmlns="http://www.w3.org/2000/svg">
                    <path d="M0,70 L50,50 L100,70 L150,30 L200,60 L250,40 L300,70 L350,20 L400,50 L450,60 L500,30 L550,50 L600,40 L650,60 L700,20 L750,40 L800,60 L850,30 L900,50 L950,40 L1000,60 V100 H0 V70 Z" fill="#3b82f6"/>
                </svg>
            </div>
            
            <div class="relative">
                <h2 class="text-3xl font-bold text-white mb-6 text-shadow">商业帝国的崛起</h2>
                <div class="max-w-2xl mx-auto mb-8">
                    <p class="text-gray-300 mb-4 leading-relaxed">
                        <span class="text-primary font-semibold">你是一位雄心勃勃的企业家</span>，刚刚创立了一家科技公司。
                        在这个<span class="text-warning font-semibold">竞争激烈的市场</span>中，每一个决策都至关重要。
                    </p>
                    <p class="text-gray-300 mb-4 leading-relaxed">
                        你需要在<span class="text-success font-semibold">资源有限</span>的情况下，平衡短期利益与长期发展，
                        应对来自<span class="text-danger font-semibold">竞争对手、投资者、员工和市场</span>的多重压力。
                    </p>
                    <p class="text-gray-300 leading-relaxed">
                        你的目标是将这家<span class="text-secondary font-semibold">初创公司</span>发展成为<span class="text-primary font-semibold">行业巨头</span>，
                        最终实现<span class="text-warning font-semibold">成功上市或被高价收购</span>的商业传奇！
                    </p>
                </div>
                <button id="start-game-btn" class="bg-gradient-to-r from-primary to-secondary text-white font-bold py-4 px-10 rounded-lg transition-all transform hover:scale-105 focus:outline-none shadow-lg hover:shadow-primary/20 border-gradient relative overflow-hidden group">
                    <span class="relative z-10 flex items-center">
                        <i class="fa fa-rocket mr-2"></i> 开启商业征程
                    </span>
                    <!-- 上升箭头装饰 -->
                    <div class="absolute -right-10 -bottom-10 opacity-20 group-hover:opacity-40 transition-opacity duration-300">
                        <svg width="80" height="80" viewBox="0 0 100 100">
                            <path d="M50,10 L80,60 L50,50 L20,60 Z" fill="white"/>
                            <polyline points="50,10 50,90" stroke="white" stroke-width="4" fill="none"/>
                        </svg>
                    </div>
                </button>
                <p class="text-gray-400 text-sm mt-4">
                    <i class="fa fa-info-circle mr-1"></i> 每次决策都将影响公司命运
                </p>
            </div>
        </div>
        
        <!-- 董事会会议界面 -->
        <div id="meeting-screen" class="hidden bg-neutral-light rounded-xl p-8 card-shadow mb-8 animate-fade-in relative overflow-hidden">
            <!-- 背景装饰 -->
            <div class="absolute inset-0 bg-business-pattern opacity-10"></div>
            
            <div class="relative">
                <div class="mb-8">
                    <div class="flex items-center justify-between mb-6">
                        <h2 id="meeting-title" class="text-2xl font-bold text-white">【第1次董事会会议】</h2>
                        <div class="bg-gray-700 text-gray-300 px-3 py-1 rounded-full text-sm">
                            <i class="fa fa-clock-o mr-1"></i>
                            <span id="meeting-time">关键决策时刻</span>
                        </div>
                    </div>
                    
                    <div class="p-6 bg-gray-800/50 rounded-xl border-l-4 border-primary mb-6 relative">
                        <div class="absolute top-3 right-3 text-primary opacity-30">
                            <i class="fa fa-commenting text-3xl"></i>
                        </div>
                        <p id="meeting-description" class="text-gray-200 leading-relaxed italic relative z-10">
                            <!-- 董事会描述将在这里显示 -->
                        </p>
                    </div>
                    
                    <div class="bg-danger/10 border border-danger/20 rounded-lg p-4 mb-8">
                        <h3 class="font-bold text-xl text-danger mb-2 flex items-center">
                            <i class="fa fa-exclamation-triangle mr-2"></i> 战略抉择时刻
                        </h3>
                        <p id="meeting-dilemma" class="text-gray-300">
                            <!-- 困境描述将在这里显示 -->
                        </p>
                    </div>
                </div>
                
                <div class="grid grid-cols-1 md:grid-cols-2 gap-8 mb-4">
                    <!-- 选项A -->
                    <div class="bg-gray-800 rounded-xl p-6 transition-all cursor-pointer transform hover:scale-[1.02] hover:shadow-lg border-2 border-transparent hover:border-primary relative overflow-hidden group" id="option-a">
                        <div class="absolute inset-0 bg-gradient-to-r from-primary/10 to-transparent opacity-0 group-hover:opacity-100 transition-opacity duration-300"></div>
                        <div class="absolute top-0 left-0 w-full h-1 bg-primary"></div>
                        <div class="flex items-center mb-4">
                            <div class="w-10 h-10 rounded-full bg-primary/20 flex items-center justify-center text-primary mr-3">
                                <span class="font-bold">A</span>
                            </div>
                            <h3 class="text-xl font-bold text-white">激进战略</h3>
                        </div>
                        <p class="text-gray-300 leading-relaxed relative z-10" id="option-a-text">
                            <!-- 选项A描述将在这里显示 -->
                        </p>
                        <div class="mt-4 text-xs text-gray-400">
                            <i class="fa fa-lightbulb-o mr-1"></i> 高风险高回报策略
                        </div>
                    </div>
                    
                    <!-- 选项B -->
                    <div class="bg-gray-800 rounded-xl p-6 transition-all cursor-pointer transform hover:scale-[1.02] hover:shadow-lg border-2 border-transparent hover:border-secondary relative overflow-hidden group" id="option-b">
                        <div class="absolute inset-0 bg-gradient-to-r from-secondary/10 to-transparent opacity-0 group-hover:opacity-100 transition-opacity duration-300"></div>
                        <div class="absolute top-0 left-0 w-full h-1 bg-secondary"></div>
                        <div class="flex items-center mb-4">
                            <div class="w-10 h-10 rounded-full bg-secondary/20 flex items-center justify-center text-secondary mr-3">
                                <span class="font-bold">B</span>
                            </div>
                            <h3 class="text-xl font-bold text-white">稳健战略</h3>
                        </div>
                        <p class="text-gray-300 leading-relaxed relative z-10" id="option-b-text">
                            <!-- 选项B描述将在这里显示 -->
                        </p>
                        <div class="mt-4 text-xs text-gray-400">
                            <i class="fa fa-shield mr-1"></i> 低风险可持续发展策略
                        </div>
                    </div>
                </div>
                
                <!-- 小指标预览区域 -->
                <div class="mt-6">
                    <div class="bg-gray-800/60 rounded-xl p-5 border border-gray-700">
                        <h4 class="text-white font-bold mb-4 flex items-center">
                            <i class="fa fa-info-circle text-primary mr-2"></i> 决策影响预览
                        </h4>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                            <!-- 股权结构预览 -->
                            <div>
                                <h5 class="text-gray-300 text-sm font-medium mb-2">股权结构</h5>
                                <div class="flex items-center space-x-2 mb-1">
                                    <div class="w-3 h-3 rounded-full bg-primary"></div>
                                    <span class="text-xs text-gray-400">CEO核心团队</span>
                                    <span id="equity-preview" class="text-white ml-auto font-medium">100%</span>
                                </div>
                                <div class="w-full bg-gray-700 rounded-full h-2">
                                    <div id="equity-preview-bar" class="bg-primary h-2 rounded-full" style="width: 100%"></div>
                                </div>
                            </div>
                            
                            <!-- 财务核心指标预览 -->
                            <div>
                                <h5 class="text-gray-300 text-sm font-medium mb-2">财务概览</h5>
                                <div class="grid grid-cols-2 gap-2">
                                    <div class="text-center p-2 bg-gray-800 rounded-lg">
                                        <p class="text-xs text-gray-400">营业收入</p>
                                        <p id="revenue-preview" class="text-white font-medium">¥0</p>
                                    </div>
                                    <div class="text-center p-2 bg-gray-800 rounded-lg">
                                        <p class="text-xs text-gray-400">净利润</p>
                                        <p id="profit-preview" class="text-white font-medium">¥0</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="text-center text-gray-500 text-sm mt-4">
                    <i class="fa fa-balance-scale mr-1"></i> 权衡利弊，做出明智决策
                </div>
            </div>
        </div>
        
        <!-- 决策反馈界面 -->
        <div id="feedback-screen" class="hidden bg-neutral-light rounded-xl p-8 card-shadow mb-8 animate-fade-in relative overflow-hidden">
            <!-- 背景装饰 -->
            <div class="absolute inset-0 bg-business-pattern opacity-10"></div>
            <div class="absolute top-0 right-0 w-64 h-64 bg-primary opacity-5 rounded-full transform translate-x-32 -translate-y-32"></div>
            
            <div class="relative">
                <h2 class="text-2xl font-bold text-white mb-6 flex items-center">
                    <i class="fa fa-line-chart text-secondary mr-3"></i> 【董事会决议反馈】
                </h2>
                <div id="feedback-text" class="text-gray-200 bg-gray-800/70 p-5 rounded-xl border-l-4 border-secondary mb-8 text-lg leading-relaxed">
                    <!-- 反馈文本将在这里显示 -->
                </div>
                
                <!-- 大指标变化 -->
                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4 mb-8">
                    <div class="bg-gray-800 rounded-xl p-4 card-shadow card-hover border-l-4 border-danger relative overflow-hidden">
                        <div class="absolute top-0 right-0 w-16 h-16 bg-danger opacity-10 rounded-full transform translate-x-8 -translate-y-8"></div>
                        <h4 class="text-sm font-medium text-gray-400 mb-2">公司控制权变化</h4>
                        <p id="control-change" class="text-2xl font-bold text-danger">
                            <!-- 控制权变化将在这里显示 -->
                        </p>
                    </div>
                    <div class="bg-gray-800 rounded-xl p-4 card-shadow card-hover border-l-4 border-warning relative overflow-hidden">
                        <div class="absolute top-0 right-0 w-16 h-16 bg-warning opacity-10 rounded-full transform translate-x-8 -translate-y-8"></div>
                        <h4 class="text-sm font-medium text-gray-400 mb-2">经营健康度变化</h4>
                        <p id="health-change" class="text-2xl font-bold text-warning">
                            <!-- 健康度变化将在这里显示 -->
                        </p>
                    <div class="bg-gray-800 rounded-xl p-4 card-shadow card-hover border-l-4 border-success relative overflow-hidden">
                        <div class="absolute top-0 right-0 w-16 h-16 bg-success opacity-10 rounded-full transform translate-x-8 -translate-y-8"></div>
                        <h4 class="text-sm font-medium text-gray-400 mb-2">团队士气变化</h4>
                        <p id="morale-change" class="text-2xl font-bold text-success">
                            <!-- 士气变化将在这里显示 -->
                        </p>
                    </div>
                    <div class="bg-gray-800 rounded-xl p-4 card-shadow card-hover border-l-4 border-primary relative overflow-hidden">
                        <div class="absolute top-0 right-0 w-16 h-16 bg-primary opacity-10 rounded-full transform translate-x-8 -translate-y-8"></div>
                        <h4 class="text-sm font-medium text-gray-400 mb-2">市场前景变化</h4>
                        <p id="market-change" class="text-2xl font-bold text-primary">
                            <!-- 市场前景变化将在这里显示 -->
                        </p>
                    </div>
                    <div class="bg-gray-800 rounded-xl p-4 card-shadow card-hover border-l-4 border-secondary relative overflow-hidden">
                        <div class="absolute top-0 right-0 w-16 h-16 bg-secondary opacity-10 rounded-full transform translate-x-8 -translate-y-8"></div>
                        <h4 class="text-sm font-medium text-gray-400 mb-2">品牌影响力变化</h4>
                        <p id="brand-change" class="text-2xl font-bold text-secondary">
                            <!-- 品牌影响力变化将在这里显示 -->
                        </p>
                    </div>
                </div>
                
                <!-- 小指标详细变化 -->
                <div class="bg-gray-800/60 rounded-xl p-5 border border-gray-700 mb-8">
                    <h4 class="text-white font-bold mb-4 flex items-center">
                        <i class="fa fa-bar-chart text-warning mr-2"></i> 详细指标变化
                    </h4>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <!-- 股权结构变化 -->
                        <div>
                            <h5 class="text-gray-300 text-sm font-medium mb-3">股权结构</h5>
                            <div class="flex items-center space-x-2 mb-1">
                                <div class="w-3 h-3 rounded-full bg-primary"></div>
                                <span class="text-xs text-gray-400">CEO核心团队</span>
                                <span id="equity-change" class="text-white ml-auto font-medium">-5%</span>
                            </div>
                            <div class="w-full bg-gray-700 rounded-full h-2 mb-3">
                                <div id="equity-change-bar" class="bg-primary h-2 rounded-full" style="width: 95%"></div>
                            </div>
                            <p class="text-xs text-gray-500">保持30%以上控制权至关重要</p>
                        </div>
                        <!-- 财务核心指标变化 -->
                        <div>
                            <h5 class="text-gray-300 text-sm font-medium mb-3">财务指标</h5>
                            <div class="space-y-3">
                                <div class="flex justify-between items-center">
                                    <span class="text-xs text-gray-400">营业收入</span>
                                    <span id="revenue-change" class="text-white font-medium">+¥100,000</span>
                                </div>
                                <div class="flex justify-between items-center">
                                    <span class="text-xs text-gray-400">营业成本</span>
                                    <span id="cost-change" class="text-white font-medium">+¥60,000</span>
                                </div>
                                <div class="flex justify-between items-center">
                                    <span class="text-xs text-gray-400">净利润</span>
                                    <span id="profit-change" class="text-white font-medium">+¥40,000</span>
                                </div>
                                <div class="flex justify-between items-center">
                                    <span class="text-xs text-gray-400">毛利率</span>
                                    <span id="margin-change" class="text-white font-medium">40%</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <button id="continue-btn" class="bg-gradient-to-r from-primary to-secondary text-white font-bold py-3 px-8 rounded-lg transition-all transform hover:scale-105 focus:outline-none shadow-lg hover:shadow-primary/20 border-gradient">
                    <i class="fa fa-arrow-right mr-2"></i> 继续商业征程
                </button>
            </div>
        </div>
        
        <!-- 游戏结局界面 -->
        <div id="ending-screen" class="hidden max-w-4xl mx-auto">
            <div class="bg-neutral-light rounded-xl p-8 card-shadow mb-6 relative overflow-hidden">
                <!-- 背景装饰 -->
                <div class="absolute inset-0 bg-business-pattern opacity-10"></div>
                <div class="absolute top-0 right-0 w-64 h-64 bg-primary opacity-5 rounded-full transform translate-x-32 -translate-y-32"></div>
                <div class="absolute bottom-0 left-0 w-64 h-64 bg-secondary opacity-5 rounded-full transform -translate-x-32 translate-y-32"></div>
                
                <div class="relative">
                    <h2 id="ending-title" class="text-3xl font-bold mb-6 text-white"></h2>
                    <p id="ending-text" class="text-xl text-gray-300 mb-8 leading-relaxed"></p>
                    
                    <!-- 标签页切换 -->
                    <div class="flex mb-8">
                        <button id="report-card-tab" class="bg-gradient-to-r from-primary to-secondary text-white py-3 px-6 font-medium rounded-lg shadow-md hover:shadow-lg transition-all transform hover:scale-[1.02] flex items-center">
                            <i class="fa fa-chart-bar mr-2"></i> 成绩单
                        </button>
                        <button id="history-tab" class="bg-gray-800 text-gray-300 py-3 px-6 font-medium rounded-lg shadow-md hover:shadow-lg transition-all transform hover:scale-[1.02] ml-4 flex items-center">
                            <i class="fa fa-history mr-2"></i> 历史记录
                        </button>
                    </div>
                    
                    <!-- 成绩单内容 -->
                    <div id="report-card-content" class="mb-8">
                        <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
                            <div class="bg-gray-800 rounded-xl p-6 card-shadow card-hover text-center relative overflow-hidden border-l-4 border-primary">
                                <div class="absolute top-0 right-0 w-16 h-16 bg-primary opacity-10 rounded-full transform translate-x-8 -translate-y-8"></div>
                                <p class="text-gray-400 mb-3">决策次数</p>
                                <h3 id="total-decisions" class="text-4xl font-bold text-primary">0</h3>
                            </div>
                            <div class="bg-gray-800 rounded-xl p-6 card-shadow card-hover text-center relative overflow-hidden border-l-4 border-secondary">
                                <div class="absolute top-0 right-0 w-16 h-16 bg-secondary opacity-10 rounded-full transform translate-x-8 -translate-y-8"></div>
                                <p class="text-gray-400 mb-3">最终得分</p>
                                <h3 id="final-score" class="text-4xl font-bold text-secondary">0</h3>
                            </div>
                            <div class="bg-gray-800 rounded-xl p-6 card-shadow card-hover text-center relative overflow-hidden border-l-4 border-warning">
                                <div class="absolute top-0 right-0 w-16 h-16 bg-warning opacity-10 rounded-full transform translate-x-8 -translate-y-8"></div>
                                <p class="text-gray-400 mb-3">等级评定</p>
                                <h3 id="final-grade" class="text-5xl font-bold text-warning">S</h3>
                            </div>
                        </div>
                        <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
                            <div class="bg-gray-800 rounded-xl p-5 card-shadow card-hover relative overflow-hidden border-l-4 border-warning">
                                <div class="absolute top-0 right-0 w-16 h-16 bg-warning opacity-10 rounded-full transform translate-x-8 -translate-y-8"></div>
                                <p class="text-gray-400 mb-2">资金状况</p>
                                <h4 id="money-score" class="text-3xl font-bold text-warning">0/100</h4>
                            </div>
                            <div class="bg-gray-800 rounded-xl p-5 card-shadow card-hover relative overflow-hidden border-l-4 border-success">
                                <div class="absolute top-0 right-0 w-16 h-16 bg-success opacity-10 rounded-full transform translate-x-8 -translate-y-8"></div>
                                <p class="text-gray-400 mb-2">团队士气</p>
                                <h4 id="morale-score" class="text-3xl font-bold text-success">0/100</h4>
                            </div>
                            <div class="bg-gray-800 rounded-xl p-5 card-shadow card-hover relative overflow-hidden border-l-4 border-primary">
                                <div class="absolute top-0 right-0 w-16 h-16 bg-primary opacity-10 rounded-full transform translate-x-8 -translate-y-8"></div>
                                <p class="text-gray-400 mb-2">市场前景</p>
                                <h4 id="market-score" class="text-3xl font-bold text-primary">0/100</h4>
                            </div>
                        </div>
                        <div class="bg-gray-800 rounded-xl p-6 card-shadow">
                            <h4 class="font-bold text-xl text-white mb-6 flex items-center">
                                <i class="fa fa-line-chart text-primary mr-3"></i> 公司发展趋势
                            </h4>
                            <div class="h-80">
                                <canvas id="history-chart"></canvas>
                            </div>
                        </div>
                    </div>
                    
                    <!-- 历史记录内容 -->
                    <div id="history-content" class="hidden">
                        <div class="mb-8">
                            <h4 class="font-bold text-xl text-white mb-6 flex items-center">
                                <i class="fa fa-sitemap text-secondary mr-3"></i> 公司发展历程时间线
                            </h4>
                            <div id="history-timeline" class="space-y-2">
                                <!-- 历史记录时间线将通过JavaScript动态生成 -->
                            </div>
                        </div>
                    </div>
                    
                    <button id="restart-btn" class="bg-gradient-to-r from-primary to-secondary text-white font-bold py-4 px-10 rounded-lg transition-all transform hover:scale-105 focus:outline-none shadow-lg hover:shadow-primary/20 border-gradient flex items-center">
                        <i class="fa fa-refresh mr-2"></i> 重新开始商业征程
                    </button>
                </div>
            </div>
        </div>
    </div>
    
    <script>
        // 游戏状态管理
        let gameState = {
            large_metrics: {
                '团队士气': 70,
                '市场前景': 40,
                '公司控制权': 100,
                '经营健康度': 50,
                '品牌影响力': 20
            },
            cash_reserve: 500000,
            monthly_revenue: 80000,
            monthly_cost: 50000,
            gross_profit: 30000,
            sales_expense: 20000,
            management_expense: 30000,
            rnd_expense: 40000,
            financial_expense: 5000,
            depreciation: 10000,
            operating_profit: -75000,
            net_profit: -80000,
            founding_team_equity: 100,
            investor_equity: 0,
            option_pool_equity: 0,
            minimum_control_threshold: 30,
            core_employee_turnover: 2,
            revenue_growth_rate: 15,
            market_share: 3,
            brand_recognition: 20,
            story_stage: 1.0,
            meeting_count: 0,
            game_over: false,
            ending_type: null,
            history: [],
            detailed_metrics: {}
        };
        
        // 图表实例
        let historyChart = null;
        
        // DOM元素
        const startScreen = document.getElementById('start-screen');
        const meetingScreen = document.getElementById('meeting-screen');
        const feedbackScreen = document.getElementById('feedback-screen');
        const endingScreen = document.getElementById('ending-screen');
        const startGameBtn = document.getElementById('start-game-btn');
        const continueBtn = document.getElementById('continue-btn');
        const restartBtn = document.getElementById('restart-btn');
        const optionA = document.getElementById('option-a');
        const optionB = document.getElementById('option-b');
        
        // 更新游戏状态显示
        function updateGameStatus() {
            const storyStage = document.getElementById('story-stage');
            const storyBar = document.getElementById('story-bar');
            
            // 更新大指标显示
            updateLargeMetrics();
            
            // 更新小指标显示
            updateDetailedMetrics();
            
            // 更新故事进度
            storyStage.textContent = `${(gameState.story_stage || 1.0).toFixed(1)}/5`;
            storyBar.style.width = `${((gameState.story_stage || 1.0) / 5) * 100}%`;
        }
        
        // 更新大指标显示
        function updateLargeMetrics() {
            // 获取所有大指标卡片
            const metricsCards = document.querySelectorAll('.metric-card');
            
            // 定义每个指标的标准配置
            const metricConfig = {
                '公司控制权': { baseColor: 'bg-danger', icon: 'fa-gavel', 
                    description: '保持30%以上至关重要，控制公司决策权' },
                '经营健康度': { baseColor: 'bg-warning', icon: 'fa-heartbeat', 
                    description: '反映公司财务状况和运营效率' },
                '团队士气': { baseColor: 'bg-success', icon: 'fa-users', 
                    description: '影响团队效率和人才留存率' },
                '市场前景': { baseColor: 'bg-primary', icon: 'fa-line-chart', 
                    description: '市场竞争格局和未来发展潜力' },
                '品牌影响力': { baseColor: 'bg-secondary', icon: 'fa-globe', 
                    description: '品牌认知度和用户忠诚度' }
            };
            
            // 更新每个大指标
            metricsCards.forEach(card => {
                const metricName = card.dataset.metric;
                if (!metricConfig[metricName]) return; // 跳过未配置的指标
                
                const config = metricConfig[metricName];
                let value;
                
                // 兼容两种数据格式
                if (gameState.large_metrics && gameState.large_metrics[metricName] !== undefined) {
                    value = gameState.large_metrics[metricName];
                } else if (gameState[metricName]) {
                    value = gameState[metricName];
                } else {
                    value = 50; // 默认值
                }
                
                // 更新数值显示
                const valueElement = card.querySelector('.metric-value');
                if (valueElement) {
                    valueElement.textContent = `${Math.round(value)}`;
                }
                
                // 更新进度条
                const barElement = card.querySelector('.metric-bar');
                if (barElement) {
                    barElement.style.width = `${value}%`;
                    
                    // 根据值设置颜色深浅
                    let colorClass = config.baseColor;
                    if (value < 30) {
                        colorClass += '-600'; // 低值 - 暗色调
                    } else if (value < 70) {
                        colorClass += '-500'; // 中值 - 标准色调
                    } else {
                        colorClass += '-400'; // 高值 - 亮色调
                    }
                    
                    barElement.className = `h-3 rounded-full transition-all duration-700 ease-out ${colorClass}`;
                }
                
                // 更新描述文本
                const descElement = card.querySelector('.metric-description');
                if (descElement) {
                    descElement.textContent = config.description;
                }
            });
        }
        
        // 更新小指标显示
        function updateDetailedMetrics() {
            // 只有在会议界面才显示小指标
            if (!meetingScreen.classList.contains('hidden')) {
                // 更新股权结构预览（在决策选项下方）
                updateEquityPreview();
                
                // 更新财务概览预览
                updateFinancialPreview();
                
                // 如果需要完整详细指标，在这里处理
                const detailedMetricsContainer = document.getElementById('detailed-metrics');
                if (detailedMetricsContainer) {
                    // 可以根据需要在这里添加更多详细指标显示
                }
            }
        }
        
        // 更新股权结构预览
        function updateEquityPreview() {
            // 优先使用small_metrics中的数据
            if (gameState.small_metrics && gameState.small_metrics.equity !== undefined) {
                const equityValue = gameState.small_metrics.equity;
                
                // 更新股权预览
                const equityElem = document.getElementById('equity-preview');
                const equityBarElem = document.getElementById('equity-preview-bar');
                const equityWarningElem = document.getElementById('equity-warning');
                
                if (equityElem) equityElem.textContent = `${equityValue}%`;
                
                if (equityBarElem) {
                    equityBarElem.style.width = `${equityValue}%`;
                    
                    // 根据股权比例设置颜色警告
                    equityBarElem.className = 'h-1.5 rounded-full transition-all duration-500';
                    if (equityValue < 30) {
                        equityBarElem.classList.add('bg-danger');
                        if (equityWarningElem) {
                            equityWarningElem.textContent = '⚠️ 控制权可能丧失！';
                            equityWarningElem.className = 'text-danger text-xs mt-1';
                        }
                    } else if (equityValue < 50) {
                        equityBarElem.classList.add('bg-warning');
                        if (equityWarningElem) {
                            equityWarningElem.textContent = '⚠️ 警惕进一步稀释';
                            equityWarningElem.className = 'text-warning text-xs mt-1';
                        }
                    } else {
                        equityBarElem.classList.add('bg-primary');
                        if (equityWarningElem) {
                            equityWarningElem.textContent = '';
                            equityWarningElem.className = 'text-xs mt-1';
                        }
                    }
                }
            } else if (gameState.detailed_metrics && gameState.detailed_metrics['股权结构']) {
                // 兼容旧数据格式
                const equityData = gameState.detailed_metrics['股权结构'];
                // 提取CEO核心团队股权
                for (const [key, value] of Object.entries(equityData)) {
                    if (key.includes('CEO') || key.includes('核心') || key.includes('团队')) {
                        const equityValue = parseFloat(value);
                        const equityElem = document.getElementById('equity-preview');
                        if (equityElem) equityElem.textContent = `${equityValue}%`;
                        
                        const equityBarElem = document.getElementById('equity-preview-bar');
                        if (equityBarElem) {
                            equityBarElem.style.width = `${equityValue}%`;
                        }
                        break;
                    }
                }
            }
        }
        
        // 更新财务概览预览
        function updateFinancialPreview() {
            // 优先使用small_metrics中的数据
            if (gameState.small_metrics) {
                // 更新营业收入
                if (gameState.small_metrics.revenue !== undefined) {
                    const revenueElem = document.getElementById('revenue-preview');
                    if (revenueElem) {
                        revenueElem.textContent = `¥${gameState.small_metrics.revenue.toLocaleString()}`;
                    }
                }
                
                // 更新净利润
                if (gameState.small_metrics.profit !== undefined) {
                    const profitElem = document.getElementById('profit-preview');
                    if (profitElem) {
                        profitElem.textContent = `¥${gameState.small_metrics.profit.toLocaleString()}`;
                        // 根据利润正负设置颜色
                        profitElem.className = 'font-bold transition-colors duration-300';
                        profitElem.classList.add(gameState.small_metrics.profit >= 0 ? 'text-white' : 'text-danger');
                    }
                }
            } else if (gameState.detailed_metrics && gameState.detailed_metrics['财务报表']) {
                // 兼容旧数据格式
                const financialData = gameState.detailed_metrics['财务报表'];
                
                if (financialData['营业收入(月)']) {
                    const revenueElem = document.getElementById('revenue-preview');
                    if (revenueElem) revenueElem.textContent = financialData['营业收入(月)'];
                }
                
                if (financialData['净利润(月)']) {
                    const profitElem = document.getElementById('profit-preview');
                    if (profitElem) profitElem.textContent = financialData['净利润(月)'];
                }
            }
        }
        
        // 创建详细指标部分
        function createDetailSection(title, metrics) {
            if (!metrics) return null;
            
            const section = document.createElement('div');
            section.className = 'bg-gray-800/60 rounded-xl p-4 mb-4 animate-fade-in';
            
            section.innerHTML = `
                <h4 class="font-bold text-white mb-3 text-sm">${title}</h4>
                <div class="grid grid-cols-2 gap-2 text-xs">
                    ${Object.entries(metrics).map(([key, value]) => `
                        <div class="flex justify-between">
                            <span class="text-gray-400">${key}</span>
                            <span class="font-medium ${getMetricColor(key, value)}">${value}</span>
                        </div>
                    `).join('')}
                </div>
            `;
            
            return section;
        }
        
        // 获取指标显示颜色
        function getMetricColor(key, value) {
            // 处理百分比指标
            if (key.includes('占比') || key.includes('率')) {
                if (typeof value === 'string') {
                    const numValue = parseFloat(value);
                    if (key.includes('股权') && numValue < gameState.minimum_control_threshold) {
                        return 'text-danger'; // 股权低于阈值显示红色
                    }
                    if (key.includes('流失率') && numValue > 10) {
                        return 'text-danger';
                    }
                    if (numValue > 50) return 'text-success';
                }
            }
            // 处理财务指标
            else if (key.includes('利润') || key.includes('收入')) {
                if (typeof value === 'string' && value.includes('-')) {
                    return 'text-danger'; // 负值显示红色
                }
                return 'text-success';
            }
            return 'text-white';
        }
        
        // 切换显示完整财务报表
        function toggleFullFinancialReport() {
            // 这里可以实现弹出完整财务报表的逻辑
            alert('财务报表详情功能开发中...');
        }
        
        // 保存历史记录
        function saveHistoryState(state) {
            if (state && state.history) {
                gameState.history = state.history;
            }
        }
        
        // 开始游戏
        startGameBtn.addEventListener('click', async () => {
            try {
                const response = await fetch('/api/start_game', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    }
                });
                
                const data = await response.json();
                gameState = data.current_state;
                saveHistoryState(data.current_state);
                updateGameStatus();
                
                // 显示会议信息
                document.getElementById('meeting-title').textContent = `【第${data.meeting_count}次会议：董事会】`;
                document.getElementById('meeting-description').textContent = data.description;
                document.getElementById('meeting-dilemma').innerHTML = `<span class="font-bold">当前困境：</span>${data.dilemma}`;
                document.getElementById('option-a-text').textContent = data.optionA;
                document.getElementById('option-b-text').textContent = data.optionB;
                
                // 切换界面
                startScreen.classList.add('hidden');
                meetingScreen.classList.remove('hidden');
                
            } catch (error) {
                console.error('开始游戏失败:', error);
                alert('游戏启动失败，请刷新页面重试');
            }
        });
        
        // 处理决策选择
        async function handleDecision(option) {
            try {
                const response = await fetch('/api/make_decision', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ option: option })
                });
                
                // 检查响应状态
                if (!response.ok) {
                    throw new Error(`HTTP错误! 状态码: ${response.status}`);
                }
                
                // 尝试解析JSON响应
                const contentType = response.headers.get('content-type');
                if (!contentType || !contentType.includes('application/json')) {
                    // 如果不是JSON响应，尝试获取文本内容并记录
                    const htmlContent = await response.text();
                    console.error('非JSON响应:', htmlContent.substring(0, 200) + '...');
                    throw new Error('服务器返回了非JSON响应');
                }
                
                const data = await response.json();
                gameState = data.current_state;
                saveHistoryState(data.current_state);
                
                // 更新反馈信息
                document.getElementById('feedback-text').textContent = data.feedback;
                
                // 格式化变化值显示
                function formatChange(value) {
                    const sign = value > 0 ? '+' : '';
                    return `${sign}${value}`;
                }
                
                // 格式化货币显示
                function formatCurrency(value) {
                    const sign = value > 0 ? '+' : '';
                    return `${sign}¥${value.toLocaleString()}`;
                }
                
                // 更新大指标变化显示
                const largeMetricsChange = {
                    'control-change': data.control_change || 0,
                    'health-change': data.health_change || 0,
                    'morale-change': data.morale_change || 0,
                    'market-change': data.market_change || 0,
                    'brand-change': data.brand_change || 0
                };
                
                // 应用默认变化值（如果API未返回）
                if (!data.control_change && !data.health_change) {
                    // 如果API未返回新指标系统数据，则使用模拟数据
                    largeMetricsChange['control-change'] = Math.floor(Math.random() * 10) - 3;
                    largeMetricsChange['health-change'] = Math.floor(Math.random() * 15) - 5;
                    largeMetricsChange['morale-change'] = Math.floor(Math.random() * 20) - 5;
                    largeMetricsChange['market-change'] = Math.floor(Math.random() * 20) - 5;
                    largeMetricsChange['brand-change'] = Math.floor(Math.random() * 15) - 3;
                }
                
                // 更新大指标变化显示并应用到gameState
                Object.entries(largeMetricsChange).forEach(([id, value]) => {
                    const element = document.getElementById(id);
                    if (element) {
                        element.textContent = formatChange(value);
                        element.className = value >= 0 ? 'text-2xl font-bold text-success' : 'text-2xl font-bold text-danger';
                    }
                    
                    // 将变化应用到gameState中的实际指标数值
                    // 映射变化ID到指标名称
                    const metricNameMap = {
                        'control-change': '公司控制权',
                        'health-change': '经营健康度',
                        'morale-change': '团队士气',
                        'market-change': '市场前景',
                        'brand-change': '品牌影响力'
                    };
                    
                    const metricName = metricNameMap[id];
                    if (metricName) {
                        // 确保gameState.large_metrics对象存在
                        if (!gameState.large_metrics) {
                            gameState.large_metrics = {};
                        }
                        
                        // 获取当前值（如果不存在则使用默认值50）
                        const currentValue = gameState.large_metrics[metricName] || 50;
                        // 应用变化值，确保结果在0-100范围内
                        gameState.large_metrics[metricName] = Math.max(0, Math.min(100, currentValue + value));
                    }
                });
                
                // 更新小指标变化显示
                const equityChange = data.equity_change || -Math.floor(Math.random() * 5) - 1;
                const equityElem = document.getElementById('equity-change');
                const equityBar = document.getElementById('equity-change-bar');
                
                if (equityElem) {
                    equityElem.textContent = equityChange > 0 ? `+${equityChange}%` : `${equityChange}%`;
                    equityElem.className = equityChange >= 0 ? 'text-white ml-auto font-medium text-success' : 'text-white ml-auto font-medium text-danger';
                }
                
                if (equityBar && gameState.small_metrics) {
                    equityBar.style.width = `${gameState.small_metrics.equity || 80}%`;
                }
                
                // 更新财务指标变化显示
                const revenueChange = data.revenue_change || Math.floor(Math.random() * 200000) + 50000;
                const costChange = data.cost_change || Math.floor(revenueChange * 0.6);
                const profitChange = data.profit_change || (revenueChange - costChange);
                const marginRate = data.margin_rate || Math.round((profitChange / revenueChange) * 100);
                
                const revenueElem = document.getElementById('revenue-change');
                const costElem = document.getElementById('cost-change');
                const profitElem = document.getElementById('profit-change');
                const marginElem = document.getElementById('margin-change');
                
                if (revenueElem) revenueElem.textContent = formatCurrency(revenueChange);
                if (costElem) costElem.textContent = formatCurrency(costChange);
                if (profitElem) {
                    profitElem.textContent = formatCurrency(profitChange);
                    profitElem.className = profitChange >= 0 ? 'text-white font-medium text-success' : 'text-white font-medium text-danger';
                }
                if (marginElem) marginElem.textContent = `${marginRate}%`;
                
                // 切换界面
                meetingScreen.classList.add('hidden');
                feedbackScreen.classList.remove('hidden');
                
                // 延迟更新状态条，显示动画效果
                setTimeout(() => {
                    updateGameStatus();
                }, 300);
                
                // 检查游戏是否结束
                if (gameState.game_over) {
                    // 准备结局界面
                    continueBtn.addEventListener('click', () => {
                        showEnding(data.ending_text);
                    }, { once: true });
                } else {
                    // 准备下一次会议
                    continueBtn.addEventListener('click', () => {
                        feedbackScreen.classList.add('hidden');
                        meetingScreen.classList.remove('hidden');
                        
                        const nextMeeting = data.next_meeting;
                        document.getElementById('meeting-title').textContent = `【第${nextMeeting.meeting_count}次会议：董事会】`;
                        document.getElementById('meeting-description').textContent = nextMeeting.description;
                        document.getElementById('meeting-dilemma').innerHTML = `<span class="font-bold">当前困境：</span>${nextMeeting.dilemma}`;
                        document.getElementById('option-a-text').textContent = nextMeeting.optionA;
                        document.getElementById('option-b-text').textContent = nextMeeting.optionB;
                    }, { once: true });
                }
                
            } catch (error) {
                console.error('处理决策失败:', error);
                
                // 添加降级处理逻辑，即使API调用失败也能模拟决策效果
                console.log('进入降级模式，使用模拟数据...');
                
                // 模拟决策反馈
                const mockFeedback = option === 'A' ? 
                    '你选择了积极扩张策略，团队士气有所提升，但也承担了更大风险。' : 
                    '你选择了稳健发展策略，虽然增长较慢，但经营更加健康。';
                document.getElementById('feedback-text').textContent = mockFeedback;
                
                // 模拟大指标变化
                const mockLargeMetricsChange = {
                    'control-change': Math.floor(Math.random() * 10) - 3,
                    'health-change': Math.floor(Math.random() * 15) - 5,
                    'morale-change': Math.floor(Math.random() * 20) - 5,
                    'market-change': Math.floor(Math.random() * 20) - 5,
                    'brand-change': Math.floor(Math.random() * 15) - 3
                };
                
                // 更新大指标变化显示
                Object.entries(mockLargeMetricsChange).forEach(([id, value]) => {
                    const element = document.getElementById(id);
                    if (element) {
                        element.textContent = value > 0 ? `+${value}` : `${value}`;
                        element.className = value >= 0 ? 'text-2xl font-bold text-success' : 'text-2xl font-bold text-danger';
                    }
                });
                
                // 模拟小指标变化
                const mockEquityChange = -Math.floor(Math.random() * 3) - 1;
                const equityElem = document.getElementById('equity-change');
                const equityBar = document.getElementById('equity-change-bar');
                
                if (equityElem) {
                    equityElem.textContent = mockEquityChange > 0 ? `+${mockEquityChange}%` : `${mockEquityChange}%`;
                    equityElem.className = mockEquityChange >= 0 ? 'text-white ml-auto font-medium text-success' : 'text-white ml-auto font-medium text-danger';
                }
                
                if (equityBar) {
                    const currentWidth = parseInt(equityBar.style.width || '100%');
                    equityBar.style.width = Math.max(0, currentWidth + mockEquityChange) + '%';
                }
                
                // 模拟财务指标变化
                const mockRevenueChange = Math.floor(Math.random() * 200000) + 50000;
                const mockCostChange = Math.floor(mockRevenueChange * 0.6);
                const mockProfitChange = mockRevenueChange - mockCostChange;
                const mockMarginRate = Math.round((mockProfitChange / mockRevenueChange) * 100);
                
                const revenueElem = document.getElementById('revenue-change');
                const costElem = document.getElementById('cost-change');
                const profitElem = document.getElementById('profit-change');
                const marginElem = document.getElementById('margin-change');
                
                if (revenueElem) revenueElem.textContent = `+¥${mockRevenueChange.toLocaleString()}`;
                if (costElem) costElem.textContent = `+¥${mockCostChange.toLocaleString()}`;
                if (profitElem) {
                    profitElem.textContent = mockProfitChange >= 0 ? `+¥${mockProfitChange.toLocaleString()}` : `-¥${Math.abs(mockProfitChange).toLocaleString()}`;
                    profitElem.className = mockProfitChange >= 0 ? 'text-white font-medium text-success' : 'text-white font-medium text-danger';
                }
                if (marginElem) marginElem.textContent = `${mockMarginRate}%`;
                
                // 切换界面
                meetingScreen.classList.add('hidden');
                feedbackScreen.classList.remove('hidden');
                
                // 更新状态条
                setTimeout(() => {
                    updateGameStatus();
                }, 300);
                
                // 准备继续按钮
                const continueBtn = document.getElementById('continue-btn');
                if (continueBtn) {
                    continueBtn.onclick = () => {
                        feedbackScreen.classList.add('hidden');
                        meetingScreen.classList.remove('hidden');
                        
                        // 模拟更新会议内容
                        const meetingCount = parseInt(document.getElementById('meeting-title').textContent.match(/第(\d+)次会议/)?.[1] || '1');
                        document.getElementById('meeting-title').textContent = `【第${meetingCount + 1}次会议：董事会】`;
                        document.getElementById('meeting-description').textContent = '新的挑战和机遇正在等待着你。';
                        document.getElementById('meeting-dilemma').innerHTML = '<span class="font-bold">当前困境：</span>公司面临新的市场竞争压力。';
                        document.getElementById('option-a-text').textContent = '加大研发投入，推出新产品';
                        document.getElementById('option-b-text').textContent = '加强市场营销，扩大现有产品份额';
                    };
                }
                
                alert('注意：使用了模拟数据，某些功能可能有限制。');
            }
        }
        
        // 计算成绩单
        function calculateReportCard() {
            if (!gameState.history || gameState.history.length === 0) return null;
            
            // 统计数据
            let totalDecisions = gameState.history.length - 1; // 减去初始状态
            
            // 使用大指标系统计算最终得分
            const largeMetrics = gameState.large_metrics || {};
            const moraleScore = largeMetrics['团队士气'] || 70;
            const marketScore = largeMetrics['市场前景'] || 40;
            const controlScore = largeMetrics['公司控制权'] || 100;
            const healthScore = largeMetrics['经营健康度'] || 50;
            const brandScore = largeMetrics['品牌影响力'] || 20;
            
            // 现金转换为百分比（假设500万为100%）
            const cashPercent = Math.min(100, Math.max(0, (gameState.cash_reserve || 500000) / 5000000 * 100));
            
            // 计算最终得分（各指标权重相等）
            let finalScore = (moraleScore + marketScore + controlScore + healthScore + brandScore + cashPercent) / 6;
            
            // 根据分数评定等级
            let grade = '';
            if (finalScore >= 80) grade = 'S';
            else if (finalScore >= 70) grade = 'A';
            else if (finalScore >= 60) grade = 'B';
            else if (finalScore >= 50) grade = 'C';
            else if (finalScore >= 40) grade = 'D';
            else grade = 'F';
            
            return {
                totalDecisions: totalDecisions,
                finalScore: Math.round(finalScore),
                grade: grade,
                moneyScore: Math.round(cashPercent),
                moraleScore: Math.round(moraleScore),
                marketScore: Math.round(marketScore),
                controlScore: Math.round(controlScore),
                healthScore: Math.round(healthScore),
                brandScore: Math.round(brandScore)
            };
        }
        
        // 渲染历史记录图表
        function renderHistoryChart() {
            // 确保有历史数据和图表元素
            if (!gameState.history || gameState.history.length === 0) return;
            
            const chartElement = document.getElementById('history-chart');
            if (!chartElement) return;
            
            // 准备数据
            const labels = gameState.history.map((item, index) => 
                index === 0 ? '初始' : `决策${index}`
            );
            
            // 从历史数据中提取并转换大指标值
            const moneyData = gameState.history.map(function(item) {
                // 使用现金值并转换为百分比
                if (item.cash_reserve !== undefined) {
                    return Math.min(100, Math.max(0, item.cash_reserve / 5000000 * 100));
                }
                return 50; // 默认值
            });
            
            const moraleData = gameState.history.map(function(item) {
                // 使用团队士气值
                if (item.large_metrics && item.large_metrics['团队士气'] !== undefined) {
                    return Math.min(100, Math.max(0, item.large_metrics['团队士气']));
                }
                return 70; // 默认值
            });
            
            const marketData = gameState.history.map(function(item) {
                // 使用市场前景值
                if (item.large_metrics && item.large_metrics['市场前景'] !== undefined) {
                    return Math.min(100, Math.max(0, item.large_metrics['市场前景']));
                }
                return 40; // 默认值
            });
            
            const controlData = gameState.history.map(function(item) {
                // 使用公司控制权值
                if (item.large_metrics && item.large_metrics['公司控制权'] !== undefined) {
                    return Math.min(100, Math.max(0, item.large_metrics['公司控制权']));
                }
                return 100; // 默认值
            });
            
            const healthData = gameState.history.map(function(item) {
                // 使用经营健康度值
                if (item.large_metrics && item.large_metrics['经营健康度'] !== undefined) {
                    return Math.min(100, Math.max(0, item.large_metrics['经营健康度']));
                }
                return 50; // 默认值
            });
            
            // 如果图表已存在，销毁它
            if (window.historyChart) {
                window.historyChart.destroy();
            }
            
            // 获取画布上下文
            const ctx = chartElement.getContext('2d');
            
            // 创建图表，显示关键大指标
            window.historyChart = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: labels,
                    datasets: [
                        {
                            label: '资金',
                            data: moneyData,
                            borderColor: '#f59e0b',
                            backgroundColor: 'rgba(245, 158, 11, 0.1)',
                            tension: 0.3,
                            fill: true
                        },
                        {
                            label: '团队士气',
                            data: moraleData,
                            borderColor: '#10b981',
                            backgroundColor: 'rgba(16, 185, 129, 0.1)',
                            tension: 0.3,
                            fill: true
                        },
                        {
                            label: '市场前景',
                            data: marketData,
                            borderColor: '#2563eb',
                            backgroundColor: 'rgba(37, 99, 235, 0.1)',
                            tension: 0.3,
                            fill: true
                        },
                        {
                            label: '公司控制权',
                            data: controlData,
                            borderColor: '#ef4444',
                            backgroundColor: 'rgba(239, 68, 68, 0.1)',
                            tension: 0.3,
                            fill: true
                        },
                        {
                            label: '经营健康度',
                            data: healthData,
                            borderColor: '#059669',
                            backgroundColor: 'rgba(5, 150, 105, 0.1)',
                            tension: 0.3,
                            fill: true
                        }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'top',
                            labels: {
                                color: '#e5e7eb'
                            }
                        },
                        title: {
                            display: true,
                            text: '公司发展趋势图',
                            color: '#f3f4f6'
                        }
                    },
                    scales: {
                        x: {
                            grid: {
                                color: 'rgba(255, 255, 255, 0.1)'
                            },
                            ticks: {
                                color: '#9ca3af'
                            }
                        },
                        y: {
                            min: 0,
                            max: 100,
                            grid: {
                                color: 'rgba(255, 255, 255, 0.1)'
                            },
                            ticks: {
                                color: '#9ca3af'
                            }
                        }
                    }
                }
            });
        }
        
        // 渲染历史记录时间线
        function renderHistoryTimeline() {
            if (!gameState.history || gameState.history.length === 0) return;
            
            const timelineContainer = document.getElementById('history-timeline');
            timelineContainer.innerHTML = '';
            
            gameState.history.forEach((event, index) => {
                // 跳过初始状态
                if (index === 0) {
                    const initialEvent = document.createElement('div');
                    initialEvent.className = 'flex mb-8 relative animate-fade-in';
                    initialEvent.innerHTML = `
                        <div class="flex flex-col items-center mr-6">
                            <div class="h-14 w-14 rounded-full bg-gradient-to-br from-primary to-secondary flex items-center justify-center text-white z-10 shadow-lg">
                                <i class="fa fa-building text-xl"></i>
                            </div>
                            ${index < gameState.history.length - 1 ? '<div class="h-full w-0.5 bg-gray-700 absolute top-14 bottom-0 left-7"></div>' : ''}
                        </div>
                        <div class="bg-gray-800 p-6 rounded-xl shadow-lg flex-1 border-l-4 border-primary card-hover">
                            <h4 class="font-bold text-primary text-xl mb-3">${event.event || '公司创立'}</h4>
                            <p class="text-gray-300 mb-4">${event.decision || '公司创立初期'}</p>
                            <div class="grid grid-cols-2 md:grid-cols-5 gap-4 text-sm">
                                ${event.large_metrics ? Object.entries(event.large_metrics).map(([key, value]) => {
                                    const colorMap = {
                                        '团队士气': 'border-success text-success',
                                        '市场前景': 'border-primary text-primary',
                                        '公司控制权': 'border-warning text-warning',
                                        '经营健康度': 'border-business-green text-business-green',
                                        '品牌影响力': 'border-secondary text-secondary'
                                    };
                                    const color = colorMap[key] || 'border-gray-500 text-white';
                                    return `
                                        <div class="bg-gray-900 rounded-lg p-3 border-l-2 ${color.split(' ')[0]}">
                                            <div class="text-xs text-gray-400 mb-1">${key}</div>
                                            <span class="font-bold ${color.split(' ')[1]}">${Math.round(value)}/100</span>
                                        </div>
                                    `;
                                }).join('') : ''}
                            </div>
                        </div>
                    `;
                    timelineContainer.appendChild(initialEvent);
                    return;
                }
                
                const timelineItem = document.createElement('div');
                timelineItem.className = 'flex mb-8 relative animate-fade-in';
                
                // 格式化变化值的显示
                function formatChange(value) {
                    const sign = value > 0 ? '+' : '';
                    return `<span class="${value > 0 ? 'text-green-500 font-bold' : value < 0 ? 'text-red-500 font-bold' : 'text-gray-400'}">${sign}${value}</span>`;
                }
                
                timelineItem.innerHTML = `
                    <div class="flex flex-col items-center mr-6">
                        <div class="h-14 w-14 rounded-full bg-gradient-to-br from-secondary to-primary flex items-center justify-center text-white z-10 shadow-lg">
                                <i class="fa fa-line-chart text-xl"></i>
                            </div>
                        ${index < gameState.history.length - 1 ? '<div class="h-full w-0.5 bg-gray-700 absolute top-14 bottom-0 left-7"></div>' : ''}
                    </div>
                    <div class="bg-gray-800 p-6 rounded-xl shadow-lg flex-1 border-l-4 border-secondary card-hover">
                        <h4 class="font-bold text-secondary text-xl mb-3">第${index}次决策: ${event.event}</h4>
                        <p class="text-gray-300 mb-3">${event.decision}</p>
                        <p class="text-gray-400 text-sm mb-4 italic">${event.feedback}</p>
                        <div class="grid grid-cols-3 gap-4 text-sm">
                            <div class="bg-gray-900 rounded-lg p-3 border-l-2 border-warning">
                                <div class="text-xs text-gray-400 mb-1">资金储备</div>
                                <div class="font-bold text-warning">${event.money}/100</div>
                                <div class="text-xs mt-1">${formatChange(event.money_change)}</div>
                            </div>
                            <div class="bg-gray-900 rounded-lg p-3 border-l-2 border-success">
                                <div class="text-xs text-gray-400 mb-1">团队士气</div>
                                <div class="font-bold text-success">${event.morale}/100</div>
                                <div class="text-xs mt-1">${formatChange(event.morale_change)}</div>
                            </div>
                            <div class="bg-gray-900 rounded-lg p-3 border-l-2 border-primary">
                                <div class="text-xs text-gray-400 mb-1">市场前景</div>
                                <div class="font-bold text-primary">${event.market_prospect}/100</div>
                                <div class="text-xs mt-1">${formatChange(event.market_prospect_change)}</div>
                            </div>
                        </div>
                    </div>
                `;
                
                timelineContainer.appendChild(timelineItem);
            });
        }
        
        // 切换标签页
        function switchTab(tabName) {
            // 隐藏所有内容
            document.getElementById('report-card-content').classList.add('hidden');
            document.getElementById('history-content').classList.add('hidden');
            
            // 重置所有标签样式
            document.getElementById('report-card-tab').classList.remove('bg-gradient-to-r', 'from-primary', 'to-secondary', 'text-white');
            document.getElementById('history-tab').classList.remove('bg-gradient-to-r', 'from-primary', 'to-secondary', 'text-white');
            document.getElementById('report-card-tab').classList.add('bg-gray-800', 'text-gray-300');
            document.getElementById('history-tab').classList.add('bg-gray-800', 'text-gray-300');
            
            // 显示选中的内容和样式
            document.getElementById(`${tabName}-content`).classList.remove('hidden');
            document.getElementById(`${tabName}-tab`).classList.remove('bg-gray-800', 'text-gray-300');
            document.getElementById(`${tabName}-tab`).classList.add('bg-gradient-to-r', 'from-primary', 'to-secondary', 'text-white');
            
            // 根据标签类型渲染对应内容
            if (tabName === 'history') {
                renderHistoryTimeline();
            } else if (tabName === 'report-card') {
                renderHistoryChart();
            }
        }
        
        // 显示结局
        function showEnding(endingText) {
            feedbackScreen.classList.add('hidden');
            endingScreen.classList.remove('hidden');
            
            // 根据结局类型设置标题和样式
            let endingTitle = '';
            let titleIcon = '';
            let titleColorClass = '';
            
            if (endingText.includes('胜利') || endingText.includes('成功')) {
                endingTitle = '恭喜成功！';
                titleIcon = 'fa-trophy';
                titleColorClass = 'bg-gradient-to-r from-green-400 to-emerald-500';
            } else if (endingText.includes('游戏结束')) {
                endingTitle = '游戏结束';
                titleIcon = 'fa-exclamation-circle';
                titleColorClass = 'bg-gradient-to-r from-red-400 to-rose-500';
            } else {
                endingTitle = '游戏结局';
                titleIcon = 'fa-chart-line';
                titleColorClass = 'bg-gradient-to-r from-primary to-secondary';
            }
            
            // 更新进度条样式 - 移到外部确保全局可访问
            const updateProgressBar = (elementId, value) => {
                const bar = document.getElementById(elementId);
                if (bar) { // 添加null检查
                    bar.style.width = `${value}%`;
                }
            };
            
            // 美化标题显示
            const endingTitleElement = document.getElementById('ending-title');
            if (endingTitleElement) {
                endingTitleElement.innerHTML = `
                    <i class="fa ${titleIcon} mr-3"></i>
                    <span class="bg-clip-text text-transparent ${titleColorClass}">${endingTitle}</span>
                `;
            }
            
            const endingTextElement = document.getElementById('ending-text');
            if (endingTextElement) {
                endingTextElement.textContent = endingText;
            }
            
            // 计算并显示成绩单
            const reportCard = calculateReportCard();
            if (reportCard) {
                // 更新成绩单数据
                const totalDecisionsEl = document.getElementById('total-decisions');
                const finalScoreEl = document.getElementById('final-score');
                const finalGradeEl = document.getElementById('final-grade');
                const moneyScoreEl = document.getElementById('money-score');
                const moraleScoreEl = document.getElementById('morale-score');
                const marketScoreEl = document.getElementById('market-score');
                
                if (totalDecisionsEl) totalDecisionsEl.textContent = reportCard.totalDecisions;
                if (finalScoreEl) finalScoreEl.textContent = reportCard.finalScore;
                if (finalGradeEl) {
                    finalGradeEl.textContent = reportCard.grade;
                    finalGradeEl.className = 'text-5xl font-bold flex items-center';
                    let gradeIcon = '';
                    
                    if (reportCard.grade === 'S') {
                        finalGradeEl.classList.add('text-amber-500');
                        gradeIcon = 'fa-crown';
                    } else if (reportCard.grade === 'A') {
                        finalGradeEl.classList.add('text-green-500');
                        gradeIcon = 'fa-star';
                    } else if (reportCard.grade === 'B') {
                        finalGradeEl.classList.add('text-blue-500');
                        gradeIcon = 'fa-thumbs-up';
                    } else if (reportCard.grade === 'C') {
                        finalGradeEl.classList.add('text-purple-500');
                        gradeIcon = 'fa-balance-scale';
                    } else if (reportCard.grade === 'D') {
                        finalGradeEl.classList.add('text-orange-500');
                        gradeIcon = 'fa-exclamation-triangle';
                    } else {
                        finalGradeEl.classList.add('text-red-500');
                        gradeIcon = 'fa-bolt';
                    }
                    
                    // 添加图标
                    finalGradeEl.innerHTML = `
                        <i class="fa ${gradeIcon} mr-2 animate-pulse"></i>
                        ${reportCard.grade}
                    `;
                }
                
                if (moneyScoreEl) moneyScoreEl.textContent = reportCard.moneyScore;
                if (moraleScoreEl) moraleScoreEl.textContent = reportCard.moraleScore;
                if (marketScoreEl) marketScoreEl.textContent = reportCard.marketScore;
                
                // 更新进度条
                updateProgressBar('money-progress', reportCard.moneyScore);
                updateProgressBar('morale-progress', reportCard.moraleScore);
                updateProgressBar('market-progress', reportCard.marketScore);
            }
            
            // 渲染历史记录图表
            renderHistoryChart();
            
            // 默认显示成绩单标签
            switchTab('report-card');
        }
        
        // 重新开始游戏
        restartBtn.addEventListener('click', () => {
            // 重置游戏状态
            gameState = {
                money: 50,
                morale: 60,
                market_prospect: 40,
                story_stage: 1.0,
                game_over: false,
                history: []
            };
            updateGameStatus();
            
            // 清除样式类
            document.getElementById('ending-title').className = 'text-3xl font-bold mb-6';
            
            // 销毁图表
            if (historyChart) {
                historyChart.destroy();
                historyChart = null;
            }
            
            // 切换到开始界面
            endingScreen.classList.add('hidden');
            startScreen.classList.remove('hidden');
        });
        
        // 标签切换事件
        document.getElementById('report-card-tab').addEventListener('click', () => switchTab('report-card'));
        document.getElementById('history-tab').addEventListener('click', () => switchTab('history'));
        
        // 选项点击事件
        // 鼠标悬停时显示决策影响预览
        optionA.addEventListener('mouseenter', () => showDecisionPreview('A'));
        optionB.addEventListener('mouseenter', () => showDecisionPreview('B'));
        
        // 鼠标离开时清除预览
        optionA.addEventListener('mouseleave', clearDecisionPreview);
        optionB.addEventListener('mouseleave', clearDecisionPreview);
        
        // 点击时提交决策
        optionA.addEventListener('click', () => handleDecision('A'));
        optionB.addEventListener('click', () => handleDecision('B'));
        
        // 显示决策影响预览
        function showDecisionPreview(option) {
            // 获取当前会议信息中的影响数据
            const currentMeeting = gameState.current_meeting || {};
            const impact = option === 'A' ? currentMeeting.impactA : currentMeeting.impactB;
            
            // 如果没有影响数据，使用模拟数据
            if (!impact) {
                // 模拟财务指标变化
                const mockRevenueChange = Math.floor(Math.random() * 100000) + 20000;
                const mockProfitChange = mockRevenueChange * (Math.random() * 0.3 + 0.1);
                
                // 更新预览显示
                updatePreviewDisplay(mockRevenueChange, mockProfitChange);
                return;
            }
            
            // 计算并更新预览显示
            // 这里需要根据实际的impact结构来计算具体的指标变化
            const revenueChange = impact.revenue || Math.floor(Math.random() * 100000) + 20000;
            const profitChange = impact.profit || revenueChange * 0.2;
            
            updatePreviewDisplay(revenueChange, profitChange);
        }
        
        // 更新预览显示
        function updatePreviewDisplay(revenueChange, profitChange) {
            // 格式化货币显示
            function formatCurrency(value) {
                return `¥${Math.abs(value).toLocaleString()}`;
            }
            
            // 更新财务预览元素
            const revenuePreviewElem = document.getElementById('revenue-preview');
            const profitPreviewElem = document.getElementById('profit-preview');
            
            if (revenuePreviewElem) {
                // 保存原始值
                if (!revenuePreviewElem.dataset.originalValue) {
                    revenuePreviewElem.dataset.originalValue = revenuePreviewElem.textContent;
                }
                // 更新为预览值
                const sign = revenueChange > 0 ? '+' : '';
                revenuePreviewElem.textContent = `${sign}${formatCurrency(revenueChange)}`;
                revenuePreviewElem.style.fontWeight = 'bold';
                revenuePreviewElem.style.color = revenueChange >= 0 ? '#4ade80' : '#f87171';
            }
            
            if (profitPreviewElem) {
                // 保存原始值
                if (!profitPreviewElem.dataset.originalValue) {
                    profitPreviewElem.dataset.originalValue = profitPreviewElem.textContent;
                }
                // 更新为预览值
                const sign = profitChange > 0 ? '+' : '';
                profitPreviewElem.textContent = `${sign}${formatCurrency(profitChange)}`;
                profitPreviewElem.style.fontWeight = 'bold';
                profitPreviewElem.style.color = profitChange >= 0 ? '#4ade80' : '#f87171';
            }
        }
        
        // 清除决策预览
        function clearDecisionPreview() {
            const revenuePreviewElem = document.getElementById('revenue-preview');
            const profitPreviewElem = document.getElementById('profit-preview');
            
            if (revenuePreviewElem && revenuePreviewElem.dataset.originalValue) {
                revenuePreviewElem.textContent = revenuePreviewElem.dataset.originalValue;
                revenuePreviewElem.style.fontWeight = '';
                revenuePreviewElem.style.color = '';
                delete revenuePreviewElem.dataset.originalValue;
            }
            
            if (profitPreviewElem && profitPreviewElem.dataset.originalValue) {
                profitPreviewElem.textContent = profitPreviewElem.dataset.originalValue;
                profitPreviewElem.style.fontWeight = '';
                profitPreviewElem.style.color = '';
                delete profitPreviewElem.dataset.originalValue;
            }
        }
        
        // 初始化状态显示
        updateGameStatus();
    </script>
</body>
</html>